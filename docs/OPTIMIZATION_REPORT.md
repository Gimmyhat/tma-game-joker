# –û—Ç—á—ë—Ç –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ TMA Game Joker

## –†–µ–∑—é–º–µ –∞–Ω–∞–ª–∏–∑–∞

| –ú–æ–¥—É–ª—å | –§–∞–π–ª–æ–≤ | –ö—Ä—É–ø–Ω–µ–π—à–∏–π —Ñ–∞–π–ª | –°—Ç–∞—Ç—É—Å |
|--------|--------|-----------------|--------|
| Frontend | 25 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ | `Table.tsx` (660 —Å—Ç—Ä–æ–∫, 26KB) | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è |
| Backend | 8 —Å–µ—Ä–≤–∏—Å–æ–≤ | `game-engine.service.ts` (963 —Å—Ç—Ä–æ–∫–∏, 30KB) | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ |
| Shared | 6 —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–∏–∫–∏ | `validator.ts` (8.7KB) | ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ |

---

## üü¶ Frontend: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (HIGH)

#### 1. –†–∞–∑–±–∏—Ç—å `Table.tsx` (660 —Å—Ç—Ä–æ–∫)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å 12 –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏.

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `TableCard.tsx` ‚Äî `renderTableCards()` (160 —Å—Ç—Ä–æ–∫)
- `TuzovanieAnimation.tsx` ‚Äî `renderTuzovanie()` (113 —Å—Ç—Ä–æ–∫)
- `OpponentHand.tsx` ‚Äî `renderOpponentHand()` (64 —Å—Ç—Ä–æ–∫–∏)
- `TrumpIndicator.tsx` ‚Äî —É–∂–µ –µ—Å—Ç—å –∫–∞–∫ –≤–ª–æ–∂–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª—É—á—à–∏–π tree-shaking.

#### 2. –î–æ–±–∞–≤–∏—Ç—å Code Splitting –≤ Vite
**–ü—Ä–æ–±–ª–µ–º–∞:** [vite.config.ts](file:///c:/Projects/Kworks/tma_game_joker/apps/frontend/vite.config.ts) –Ω–µ –∏–º–µ–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è chunking.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        'vendor-react': ['react', 'react-dom'],
        'vendor-framer': ['framer-motion'],
        'vendor-telegram': ['@telegram-apps/sdk', '@telegram-apps/sdk-react'],
        'vendor-i18n': ['i18next', 'react-i18next'],
      }
    }
  }
}
```
**–≠—Ñ—Ñ–µ–∫—Ç:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ vendor-—á–∞–Ω–∫–æ–≤ –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏, —É–º–µ–Ω—å—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏.

### üü° –°—Ä–µ–¥–Ω–∏–µ (MEDIUM)

#### 3. Lazy Loading –¥–ª—è GameScreen
**–ü—Ä–æ–±–ª–µ–º–∞:** `GameScreen` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É, —Ö–æ—Ç—è –Ω–µ –Ω—É–∂–µ–Ω –≤ –ª–æ–±–±–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```tsx
const GameScreen = React.lazy(() => import('./screens/GameScreen'));

// –í GameContent:
if (isGameActive) {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <GameScreen />
    </Suspense>
  );
}
```

#### 4. –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –≤ Zustand
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ [gameStore.ts](file:///c:/Projects/Kworks/tma_game_joker/apps/frontend/src/store/gameStore.ts) —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ.

**–ü—Ä–∏–º–µ—Ä `selectOtherPlayers`:**
```typescript
// –ë–´–õ–û ‚Äî —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ –∫–∞–∂–¥—ã–π —Ä–∞–∑
state.gameState?.players.filter(p => p.id !== state.currentPlayerId)

// –°–¢–ê–õ–û ‚Äî —Å shallow compare
import { shallow } from 'zustand/shallow';
const otherPlayers = useGameStore(selectOtherPlayers, shallow);
```

#### 5. –£–±—Ä–∞—Ç—å debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `GameGateway` –µ—Å—Ç—å `client.onAny()` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π.

---

## üü© Backend: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (HIGH)

#### 1. –†–∞–∑–±–∏—Ç—å `game-engine.service.ts` (963 —Å—Ç—Ä–æ–∫–∏)
**–ü—Ä–æ–±–ª–µ–º–∞:** God-object —Å 20+ –º–µ—Ç–æ–¥–∞–º–∏.

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–¥–µ–ª–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:
- `TrumpService` ‚Äî `selectTrump()`, `handleRedeal()` (170 —Å—Ç—Ä–æ–∫)
- `RoundService` ‚Äî `completeRound()`, `dealNewRound()` (200 —Å—Ç—Ä–æ–∫)
- `PulkaService` ‚Äî `completePulka()`, `startNextPulka()` (100 —Å—Ç—Ä–æ–∫)

**–≠—Ñ—Ñ–µ–∫—Ç:** Single Responsibility, –ø—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

#### 2. –î–æ–±–∞–≤–∏—Ç—å Redis Pipeline –¥–ª—è batch-–æ–ø–µ—Ä–∞—Ü–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ pipelining –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è broadcast state ‚Üí pipeline –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.

### üü° –°—Ä–µ–¥–Ω–∏–µ (MEDIUM)

#### 3. –î–æ–±–∞–≤–∏—Ç—å Rate Limiting –Ω–∞ WebSocket
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç —Ñ–ª—É–¥–∞ —Å–æ–±—ã—Ç–∏—è–º–∏.

**–†–µ—à–µ–Ω–∏–µ:** Throttle –Ω–∞ `throw_card` (1 –∫–∞—Ä—Ç–∞ –≤ 300ms).

#### 4. Graceful Shutdown
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ.

---

## üü™ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üü° –°—Ä–µ–¥–Ω–∏–µ (MEDIUM)

#### 1. –î–æ–±–∞–≤–∏—Ç—å Health Check —Å –¥–µ—Ç–∞–ª—è–º–∏
**–°—É—â–µ—Å—Ç–≤—É–µ—Ç:** `health/` –º–æ–¥—É–ª—å, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** Endpoint `/health` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π Redis connectivity.

#### 2. Structured Logging
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** Pino –∏–ª–∏ Winston –≤–º–µ—Å—Ç–æ console.log –¥–ª—è JSON-–ª–æ–≥–æ–≤.

#### 3. Source Maps —Ç–æ–ª—å–∫–æ –¥–ª—è staging
**–ü—Ä–æ–±–ª–µ–º–∞:** `sourcemap: true` –≤ production –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥.

**–†–µ—à–µ–Ω–∏–µ:** `sourcemap: process.env.NODE_ENV !== 'production'`

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è

| # | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –≠—Ñ—Ñ–µ–∫—Ç |
|---|--------|-----------|-----------|--------|
| 1 | Code Splitting (Vite) | HIGH | Low | –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ |
| 2 | –†–∞–∑–±–∏—Ç—å Table.tsx | HIGH | Medium | Maintainability |
| 3 | –†–∞–∑–±–∏—Ç—å game-engine.service.ts | HIGH | High | Maintainability |
| 4 | Lazy Loading GameScreen | MEDIUM | Low | Bundle size |
| 5 | –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ | MEDIUM | Low | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| 6 | Rate Limiting WebSocket | MEDIUM | Medium | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
| 7 | Source Maps control | LOW | Low | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–∞—á–∞—Ç—å —Å –Ω–∏–∑–∫–æ–∑–∞—Ç—Ä–∞—Ç–Ω—ã—Ö:** Code Splitting –≤ Vite (#1) ‚Äî 15 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã
2. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Table.tsx** ‚Äî –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
3. **Backend —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** ‚Äî –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ø—Ä–∏–Ω—Ç
