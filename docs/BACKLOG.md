# –ë—ç–∫–ª–æ–≥ –∏ –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è (TMA Joker)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–¥–∞—á–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è –±—É–¥—É—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

## 0. Telegram Bot Integration ‚úÖ DONE

Telegram –±–æ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Mini App.

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

- `TelegramBotModule` —Å grammy –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π
- –ö–æ–º–∞–Ω–¥—ã `/start` (—Å WebApp –∫–Ω–æ–ø–∫–æ–π) –∏ `/help` (–ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã)
- Graceful shutdown –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `TELEGRAM_BOT_TOKEN` –∏ `WEBAPP_URL`

### Dev Workflow —Å Cloudflare Tunnel (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cloudflared (Windows)
winget install Cloudflare.cloudflared

# –¢–µ—Ä–º–∏–Ω–∞–ª 1: Frontend
cd apps/frontend && pnpm dev

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: Cloudflare —Ç—É–Ω–Ω–µ–ª—å
cloudflared tunnel --url http://localhost:5173
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTTPS URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://random-name.trycloudflare.com)

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: –û–±–Ω–æ–≤–∏—Ç—å .env –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å backend
# –í apps/backend/.env —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WEBAPP_URL=https://random-name.trycloudflare.com
cd apps/backend && pnpm dev

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞ –≤ Telegram, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å /start, –Ω–∞–∂–∞—Ç—å "–ò–≥—Ä–∞—Ç—å"
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: ngrok

```bash
ngrok http 5173
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTTPS URL –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ WEBAPP_URL
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ BotFather:

```
/setdescription ‚Üí üÉè Joker - –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è 4 –∏–≥—Ä–æ–∫–æ–≤
/setabouttext ‚Üí –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ Joker
/setcommands ‚Üí start - –ù–∞—á–∞—Ç—å –∏–≥—Ä—É, help - –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã
```

## 1. –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä –∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (–í–∞–∂–Ω–æ –¥–ª—è Production)

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–ø–æ—Ä–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é **"–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –¥–∞–º–ø —Å–æ—Å—Ç–æ—è–Ω–∏—è"** (Snapshotting).

- **–•—Ä–∞–Ω–∏–ª–∏—â–µ:** PostgreSQL, —Ç–∞–±–ª–∏—Ü–∞ `games`, –∫–æ–ª–æ–Ω–∫–∞ `replay_data` (—Ç–∏–ø `JSONB`).
- **–ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å:** –ú–∞—Å—Å–∏–≤ `history: RoundHistory[]` –∏–∑ `GameState`. –≠—Ç–æ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ö–æ–¥—ã, —Å—Ç–∞–≤–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ä–∞—É–Ω–¥–∞–º.
- **–ö–æ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å:**
  1.  **–ö–æ–Ω–µ—Ü –ø—É–ª—å–∫–∏ (PulkaComplete):** –û–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–ø–∏—Å—å –≤ –ë–î. –≠—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É (–≤—Å–µ–≥–æ 4 –∑–∞–ø–∏—Å–∏ –Ω–∞ –∏–≥—Ä—É) –∏ —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ–µ —Å–µ—Ä–≤–µ—Ä–∞ (–º–∞–∫—Å–∏–º—É–º 1 –ø—É–ª—å–∫–∞).
  2.  **–ö–æ–Ω–µ—Ü –∏–≥—Ä—ã (GameFinished):** –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

1.  –í `GameEngineService` –∏–ª–∏ `GameGateway`:
    - –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ —Ñ–∞–∑—É `PulkaComplete` –∏ `Finished` –≤—ã–∑—ã–≤–∞—Ç—å `DatabaseService.saveGameHistory(gameId, history)`.
2.  –°–æ–∑–¥–∞—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /games/:id/history` (–¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è Admin).
3.  –í –ê–¥–º–∏–Ω–∫–µ —Å–¥–µ–ª–∞—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä: –∑–∞–≥—Ä—É–∂–∞—Ç—å JSON –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ö–æ–¥–æ–≤.

## 2. –£–ª—É—á—à–µ–Ω–∏–µ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ (Dev Ops)

- **Graceful Shutdown:** –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–µ–∫—É—â–∏–µ —Å—Ç–µ–π—Ç—ã –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä –≤ Redis/DB, —á—Ç–æ–±—ã –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö.
- **Reconnect:** –£–ª—É—á—à–∏—Ç—å UX –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å "–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞..." –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö).

## 3. UI/UX

- **–ê–Ω–∏–º–∞—Ü–∏–∏:** –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é —Ä–∞–∑–¥–∞—á–∏ –∫–∞—Ä—Ç (—Å–µ–π—á–∞—Å –æ–Ω–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ).
- **–ó–≤—É–∫–∏:** –î–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (—Ö–æ–¥, –ø–æ–±–µ–¥–∞, –æ—à–∏–±–∫–∞).
