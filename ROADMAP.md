# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: Backend –¥–ª—è –∫–∞—Ä—Ç–æ—á–Ω–æ–π –∏–≥—Ä—ã Joker

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ü—Ä–æ–µ–∫—Ç:** Real-time multiplayer –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ "Joker" –¥–ª—è Telegram MiniApp  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Telegram WebApp (–º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –≤–µ–±)  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:** 4 (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞–º–µ–Ω—ã –±–æ—Ç–∞–º–∏)  
**–ë—é–¥–∂–µ—Ç:** 200 000 ‚ÇΩ  
**–°—Ä–æ–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** 7-8 –Ω–µ–¥–µ–ª—å (56 –¥–Ω–µ–π)  
**–û–∂–∏–¥–∞–µ–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:** 100-200 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä (400-800 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)

---

## üéØ –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å **server authoritative** backend –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ä—Ç–æ—á–Ω–æ–π –∏–≥—Ä—ã —Å:
- –°—Ç—Ä–æ–≥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø—Ä–∞–≤–∏–ª
- Real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
- –ó–∞—â–∏—Ç–æ–π –æ—Ç —á–∏—Ç–æ–≤
- –°—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π –≤ —É—Å–ª–æ–≤–∏—è—Ö –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

### –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª –∏–≥—Ä—ã (24 —Ä–∞–∑–¥–∞—á–∏, 4 "–ø—É–ª—å–∫–∏", –ø—Ä–µ–º–∏–∏, —à—Ç—Ä–∞—Ñ—ã)
2. ‚úÖ –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑—Ä—ã–≤–∞–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Telegram lifecycle –Ω–∞ iOS)
3. ‚úÖ –ó–∞–º–µ–Ω–∞ –æ—Ç–∫–ª—é—á–∏–≤—à–∏—Ö—Å—è –∏–≥—Ä–æ–∫–æ–≤ –±–æ—Ç–∞–º–∏
4. ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ unit-—Ç–µ—Å—Ç–∞–º–∏ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª (80%+)
5. ‚úÖ API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

---

## üèóÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend Framework
- **Node.js 20+** (LTS –≤–µ—Ä—Å–∏—è)
- **NestJS 10+** ‚Äî –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, DI, –≥–æ—Ç–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WebSocket
- **TypeScript 5+** ‚Äî —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

### Real-time Communication
- **Socket.io 4+** (–ù–ï uWebSockets.js)
  - **–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**
    - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Telegram)
    - ‚úÖ Fallback –Ω–∞ Long Polling (–µ—Å–ª–∏ WebSocket –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)
    - ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ NestJS (`@nestjs/websockets`)
    - ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Room API
    - ‚úÖ –ë–æ–ª—å—à–æ–µ –∫–æ–º—å—é–Ω–∏—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
  - **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 100,000 msg/sec (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 100-200 –∏–≥—Ä)

### Databases
- **Redis 7+** ‚Äî Hot Data (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏)
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
  - TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∏–≥—Ä
  - Pub/Sub –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ)
  
- **PostgreSQL 15+** ‚Äî Cold Data (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
  - –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∏–≥—Ä
  - –ü—Ä–æ—Ñ–∏–ª–∏ –∏–≥—Ä–æ–∫–æ–≤
  - –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
  - **–§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è:** JSONB (–ù–ï –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- **@nestjs/typeorm** ‚Äî ORM –¥–ª—è PostgreSQL
- **ioredis** ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è Redis
- **class-validator** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO
- **jest** ‚Äî unit –∏ integration —Ç–µ—Å—Ç—ã
- **@types/node** ‚Äî —Ç–∏–ø–∏–∑–∞—Ü–∏—è Node.js API

### DevOps (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –¥–ª—è MVP)
- **Docker + Docker Compose** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **PM2** ‚Äî process manager —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
- **GitHub Actions** ‚Äî CI/CD (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### High-Level Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot   ‚îÇ (notifications, auth validation)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         NestJS Application              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ   WebSocket Gateway (Socket.io)  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Connection Management         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Room Manager                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Event Handlers                ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ             ‚îÇ                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ      Game Engine (Core)          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - State Machine                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Move Validator                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Scoring Calculator            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Bot AI (Dumb Bot)             ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ             ‚îÇ                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Redis Service   ‚îÇ  ‚îÇ Postgres   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  (Hot State)      ‚îÇ  ‚îÇ (History)  ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (NestJS)

```
src/
‚îú‚îÄ‚îÄ app.module.ts                 # Root module
‚îú‚îÄ‚îÄ main.ts                       # Application entry point
‚îÇ
‚îú‚îÄ‚îÄ auth/                         # Telegram authentication
‚îÇ   ‚îú‚îÄ‚îÄ auth.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ telegram.guard.ts
‚îÇ
‚îú‚îÄ‚îÄ game/                         # Core game logic
‚îÇ   ‚îú‚îÄ‚îÄ game.module.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # Data models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ card.model.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ player.model.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game-state.model.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ enums.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ validators/               # Rule validation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ move.validator.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bet.validator.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ joker.validator.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # Business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game-engine.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scoring.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deck.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ state-machine.service.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ tests/                    # Unit tests
‚îÇ       ‚îú‚îÄ‚îÄ game-engine.spec.ts
‚îÇ       ‚îú‚îÄ‚îÄ scoring.spec.ts
‚îÇ       ‚îî‚îÄ‚îÄ validators.spec.ts
‚îÇ
‚îú‚îÄ‚îÄ gateway/                      # WebSocket layer
‚îÇ   ‚îú‚îÄ‚îÄ gateway.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ game.gateway.ts
‚îÇ   ‚îú‚îÄ‚îÄ room.manager.ts
‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îÇ       ‚îú‚îÄ‚îÄ join-room.dto.ts
‚îÇ       ‚îú‚îÄ‚îÄ make-bet.dto.ts
‚îÇ       ‚îî‚îÄ‚îÄ throw-card.dto.ts
‚îÇ
‚îú‚îÄ‚îÄ bot/                          # Bot AI
‚îÇ   ‚îú‚îÄ‚îÄ bot.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ bot.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ strategies/
‚îÇ       ‚îî‚îÄ‚îÄ random-valid-move.strategy.ts
‚îÇ
‚îú‚îÄ‚îÄ database/                     # Data persistence
‚îÇ   ‚îú‚îÄ‚îÄ database.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ redis.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ game.repository.ts
‚îÇ   ‚îî‚îÄ‚îÄ entities/
‚îÇ       ‚îî‚îÄ‚îÄ game.entity.ts
‚îÇ
‚îú‚îÄ‚îÄ api/                          # REST API (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)
‚îÇ   ‚îú‚îÄ‚îÄ api.module.ts
‚îÇ   ‚îî‚îÄ‚îÄ controllers/
‚îÇ       ‚îú‚îÄ‚îÄ games.controller.ts
‚îÇ       ‚îî‚îÄ‚îÄ leaderboard.controller.ts
‚îÇ
‚îî‚îÄ‚îÄ common/                       # Shared utilities
    ‚îú‚îÄ‚îÄ constants.ts
    ‚îú‚îÄ‚îÄ exceptions/
    ‚îî‚îÄ‚îÄ interceptors/
```

---

## üéÆ –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ (–ü—Ä–∞–≤–∏–ª–∞)

### –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã

**Joker** ‚Äî –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ –¥–ª—è 4 –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ 24 —Ä–∞—É–Ω–¥–æ–≤ (—Ä–∞–∑–¥–∞—á–∏).

**–¶–µ–ª—å:** –ù–∞–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤ –∑–∞ 4 "–ø—É–ª—å–∫–∏" (–±–ª–æ–∫–∞ —Ä–∞–∑–¥–∞—á).

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è:**
- **–†–∞–∑–¥–∞—á–∞ (–†–∞—É–Ω–¥):** –ò–≥—Ä–æ–∫–∞–º —Ä–∞–∑–¥–∞–µ—Ç—Å—è N –∫–∞—Ä—Ç, –æ–Ω–∏ –¥–µ–ª–∞—é—Ç –∑–∞–∫–∞–∑—ã (bet) –∏ –∏–≥—Ä–∞—é—Ç
- **–í–∑—è—Ç–∫–∞ (Trick):** 4 –∫–∞—Ä—Ç—ã –Ω–∞ —Å—Ç–æ–ª–µ, –∑–∞–±–∏—Ä–∞–µ—Ç –∏–≥—Ä–æ–∫ —Å —Å–∞–º–æ–π —Å–∏–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ–π
- **–ó–∞–∫–∞–∑ (Bet):** –ü—Ä–æ–≥–Ω–æ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∑—è—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–æ–∫ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –≤–∑—è—Ç—å
- **–ü—É–ª—å–∫–∞:** –ë–ª–æ–∫ –∏–∑ 8-9 —Ä–∞–∑–¥–∞—á, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—á–∫–∏ –∏ –ø—Ä–µ–º–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–≥—Ä—ã (24 —Ä–∞—É–Ω–¥–∞)

#### –ü—É–ª—å–∫–∞ 1 (—Ä–∞—É–Ω–¥—ã 1-8): –†–∞–∑–¥–∞—á–∏ –æ—Ç 1 –¥–æ 8
- –†–∞—É–Ω–¥ 1: 1 –∫–∞—Ä—Ç–∞ –∫–∞–∂–¥–æ–º—É
- –†–∞—É–Ω–¥ 2: 2 –∫–∞—Ä—Ç—ã –∫–∞–∂–¥–æ–º—É
- ...
- –†–∞—É–Ω–¥ 8: 8 –∫–∞—Ä—Ç –∫–∞–∂–¥–æ–º—É

#### –ü—É–ª—å–∫–∞ 2 (—Ä–∞—É–Ω–¥ 9): –†–∞–∑–¥–∞—á–∞ –ø–æ 9 –∫–∞—Ä—Ç
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ò–≥—Ä–æ–∫ —Å –ø—Ä–∞–≤–æ–º —Ö–æ–¥–∞ –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–∑—ã—Ä—å (–∏–ª–∏ "–±–µ–∑ –∫–æ–∑—ã—Ä–µ–π")
- –í—Å–µ–º —Ä–∞–∑–¥–∞–µ—Ç—Å—è –ø–æ 3 –∫–∞—Ä—Ç—ã, –∏–≥—Ä–æ–∫ –ø–æ—Å–ª–µ —Ä–∞–∑–¥–∞—é—â–µ–≥–æ –≤–∏–¥–∏—Ç —Å–≤–æ–∏ 3 –∫–∞—Ä—Ç—ã –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –º–∞—Å—Ç—å –∫–æ–∑—ã—Ä—è

#### –ü—É–ª—å–∫–∞ 3 (—Ä–∞—É–Ω–¥—ã 10-17): –†–∞–∑–¥–∞—á–∏ –æ—Ç 8 –¥–æ 1
- –†–∞—É–Ω–¥ 10: 8 –∫–∞—Ä—Ç –∫–∞–∂–¥–æ–º—É
- –†–∞—É–Ω–¥ 11: 7 –∫–∞—Ä—Ç –∫–∞–∂–¥–æ–º—É
- ...
- –†–∞—É–Ω–¥ 17: 1 –∫–∞—Ä—Ç–∞ –∫–∞–∂–¥–æ–º—É

#### –ü—É–ª—å–∫–∞ 4 (—Ä–∞—É–Ω–¥ 18-24): –ö–æ–ø–∏—è –ø—É–ª—å–∫–∏ 2
- –†–∞—É–Ω–¥—ã 18-24: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–∞—É–Ω–¥–∞–º 2-8
- –†–∞—É–Ω–¥ 24 (–ø–æ—Å–ª–µ–¥–Ω–∏–π): 9 –∫–∞—Ä—Ç, –≤—ã–±–æ—Ä –∫–æ–∑—ã—Ä—è

> **‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –£–¢–û–ß–ù–ï–ù–ò–Ø (—Å–º. OPEN_QUESTIONS Q9):**
> –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –ø—Ä–∞–≤–∏–ª–∞–º! –í –ø—Ä–∞–≤–∏–ª–∞—Ö —Å–∫–∞–∑–∞–Ω–æ "–ß–µ—Ç–≤—ë—Ä—Ç—ã–π –∫—Ä—É–≥ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–ø–∏–µ–π –≤—Ç–æ—Ä–æ–≥–æ –∫—Ä—É–≥–∞" (—Ç.–µ. –ø–æ 9 –∫–∞—Ä—Ç —Å –≤—ã–±–æ—Ä–æ–º –∫–æ–∑—ã—Ä—è), –∞ –Ω–µ —Ä–∞–∑–¥–∞—á–∏ –ø–æ 2-8 –∫–∞—Ä—Ç.
> –í–æ–∑–º–æ–∂–Ω—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –ü—É–ª—å–∫–∞ 2 = 4 —Ä–∞–∑–¥–∞—á–∏ –ø–æ 9 –∫–∞—Ä—Ç, –ü—É–ª—å–∫–∞ 4 = 4 —Ä–∞–∑–¥–∞—á–∏ –ø–æ 9 –∫–∞—Ä—Ç (8+4+8+4=24).

### –ö–æ–ª–æ–¥–∞ –∫–∞—Ä—Ç

**–°–æ—Å—Ç–∞–≤:** 36 –∫–∞—Ä—Ç (34 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ + 2 –¥–∂–æ–∫–µ—Ä–∞)
- –ú–∞—Å—Ç–∏: ‚ô•Ô∏è –ß–µ—Ä–≤—ã, ‚ô¶Ô∏è –ë—É–±–Ω—ã, ‚ô£Ô∏è –¢—Ä–µ—Ñ—ã, ‚ô†Ô∏è –ü–∏–∫–∏
- –†–∞–Ω–≥–∏: 6, 7, 8, 9, 10, J (–í–∞–ª–µ—Ç), Q (–î–∞–º–∞), K (–ö–æ—Ä–æ–ª—å), A (–¢—É–∑)
- **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:** –ß–µ—Ä–Ω—ã–µ —à–µ—Å—Ç–µ—Ä–∫–∏ (6‚ô£Ô∏è, 6‚ô†Ô∏è)
- **–î–∂–æ–∫–µ—Ä—ã:** 2 –∫–∞—Ä—Ç—ã (—Å–∞–º—ã–µ —Å–∏–ª—å–Ω—ã–µ –≤ –∫–æ–ª–æ–¥–µ)

**–°—Ç–∞—Ä—à–∏–Ω—Å—Ç–≤–æ –∫–∞—Ä—Ç:** 6 < 7 < 8 < 9 < 10 < J < Q < K < A < –î–∂–æ–∫–µ—Ä

**–°—Ç–∞—Ä—à–∏–Ω—Å—Ç–≤–æ –º–∞—Å—Ç–µ–π:** –í—Å–µ –º–∞—Å—Ç–∏ —Ä–∞–≤–Ω—ã, –∫—Ä–æ–º–µ **–∫–æ–∑—ã—Ä–Ω–æ–π –º–∞—Å—Ç–∏** (trump), –∫–æ—Ç–æ—Ä–∞—è –±—å–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ö–æ–¥–∞

#### 1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –º–∞—Å—Ç–∏
–ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫ –∑–∞—à–µ–ª —Å –º–∞—Å—Ç–∏ X:
- **–ï—Å—Ç—å –º–∞—Å—Ç—å X:** –û–ë–Ø–ó–ê–ù –∏–≥—Ä–∞—Ç—å –º–∞—Å—Ç—å X
- **–ù–µ—Ç –º–∞—Å—Ç–∏ X, –µ—Å—Ç—å –∫–æ–∑—ã—Ä—å:** –û–ë–Ø–ó–ê–ù –∏–≥—Ä–∞—Ç—å –∫–æ–∑—ã—Ä—å
- **–ù–µ—Ç –º–∞—Å—Ç–∏ X –∏ –∫–æ–∑—ã—Ä—è:** –ú–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –ª—é–±—É—é –∫–∞—Ä—Ç—É

#### 2. –î–∂–æ–∫–µ—Ä
–î–∂–æ–∫–µ—Ä –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å **–≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç**, –¥–∞–∂–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç—Ä–µ–±—É–µ–º–æ–π –º–∞—Å—Ç–∏ –∏–ª–∏ –∫–æ–∑—ã—Ä—è.

**4 —Å–≤–æ–π—Å—Ç–≤–∞ –î–∂–æ–∫–µ—Ä–∞:**

##### –°–≤–æ–π—Å—Ç–≤–æ 1: "–í—ã—Å—à–∞—è –∫–∞—Ä—Ç–∞ –º–∞—Å—Ç–∏" (High)
–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —Ö–æ–¥–∏—Ç **–ø–µ—Ä–≤—ã–º** —Å –î–∂–æ–∫–µ—Ä–∞:
- –ú–æ–∂–µ—Ç –∑–∞–∫–∞–∑–∞—Ç—å "–≤—ã—Å—à—É—é –∫–∞—Ä—Ç—É –º–∞—Å—Ç–∏ X"
- –î–∂–æ–∫–µ—Ä –∏–≥—Ä–∞–µ—Ç—Å—è –∫–∞–∫ **–≤—ã—Å—à–∞—è –∫–∞—Ä—Ç–∞ –º–∞—Å—Ç–∏ X**
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ **–û–ë–Ø–ó–ê–ù–´** –ø–æ–ª–æ–∂–∏—Ç—å **—Å–∞–º—É—é –≤—ã—Å—à—É—é –∫–∞—Ä—Ç—É –º–∞—Å—Ç–∏ X** –∏–∑ —Å–≤–æ–µ–π —Ä—É–∫–∏
- –ï—Å–ª–∏ —É –∏–≥—Ä–æ–∫–∞ –Ω–µ—Ç –º–∞—Å—Ç–∏ X ‚Üí –∏–≥—Ä–∞—é—Ç –∫–æ–∑—ã—Ä—å
- –ï—Å–ª–∏ –Ω–µ—Ç –º–∞—Å—Ç–∏ –∏ –∫–æ–∑—ã—Ä—è ‚Üí –ª—é–±—É—é –∫–∞—Ä—Ç—É

##### –°–≤–æ–π—Å—Ç–≤–æ 2: "–ú–ª–∞–¥—à–∞—è –∫–∞—Ä—Ç–∞ –º–∞—Å—Ç–∏" (Low)
–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —Ö–æ–¥–∏—Ç **–ø–µ—Ä–≤—ã–º** —Å –î–∂–æ–∫–µ—Ä–∞:
- –ú–æ–∂–µ—Ç –∑–∞–∫–∞–∑–∞—Ç—å "–º–ª–∞–¥—à—É—é –∫–∞—Ä—Ç—É –º–∞—Å—Ç–∏ X"
- –î–∂–æ–∫–µ—Ä –∏–≥—Ä–∞–µ—Ç—Å—è –∫–∞–∫ **–º–ª–∞–¥—à–∞—è –∫–∞—Ä—Ç–∞ –º–∞—Å—Ç–∏ X**
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ –∫–ª–∞–¥—É—Ç **–ª—é–±—É—é –∫–∞—Ä—Ç—É –º–∞—Å—Ç–∏ X**
- –í–∑—è—Ç–∫—É –±–µ—Ä–µ—Ç –∏–≥—Ä–æ–∫ —Å —Å–∞–º–æ–π —Å–∏–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ–π –º–∞—Å—Ç–∏ X
- –ï—Å–ª–∏ —É –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ—Ç –º–∞—Å—Ç–∏ X ‚Üí –≤–∑—è—Ç–∫—É –±–µ—Ä–µ—Ç –∏–≥—Ä–æ–∫ —Å –î–∂–æ–∫–µ—Ä–æ–º

##### –°–≤–æ–π—Å—Ç–≤–æ 3: "–°–≤–µ—Ä—Ö—É" (Top)
–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –∏–≥—Ä–∞–µ—Ç –î–∂–æ–∫–µ—Ä–∞ **–Ω–µ –ø–µ—Ä–≤—ã–º**:
- –ú–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ü–∏—é "–°–≤–µ—Ä—Ö—É"
- –î–∂–æ–∫–µ—Ä **–ø–æ–±–µ–∂–¥–∞–µ—Ç** –≤—Å–µ –∫–∞—Ä—Ç—ã –Ω–∞ —Å—Ç–æ–ª–µ
- –ò–≥—Ä–æ–∫ —Å –î–∂–æ–∫–µ—Ä–æ–º –∑–∞–±–∏—Ä–∞–µ—Ç –≤–∑—è—Ç–∫—É

##### –°–≤–æ–π—Å—Ç–≤–æ 4: "–°–Ω–∏–∑—É" (Bottom)
–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –∏–≥—Ä–∞–µ—Ç –î–∂–æ–∫–µ—Ä–∞ **–Ω–µ –ø–µ—Ä–≤—ã–º**:
- –ú–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ü–∏—é "–°–Ω–∏–∑—É"
- –î–∂–æ–∫–µ—Ä **–ù–ï –ø–æ–±–µ–∂–¥–∞–µ—Ç** (–≤–µ–¥–µ—Ç —Å–µ–±—è –∫–∞–∫ —Å–∞–º–∞—è —Å–ª–∞–±–∞—è –∫–∞—Ä—Ç–∞)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ —Ö–æ—á–µ—Ç –ù–ï –±—Ä–∞—Ç—å –≤–∑—è—Ç–∫—É

**–û—Å–æ–±—ã–π —Å–ª—É—á–∞–π:** –ï—Å–ª–∏ –Ω–∞ —Å—Ç–æ–ª–µ **–¥–≤–∞ –î–∂–æ–∫–µ—Ä–∞ —Å –æ–ø—Ü–∏–µ–π "–°–≤–µ—Ä—Ö—É"** ‚Üí –≤–∑—è—Ç–∫—É –±–µ—Ä–µ—Ç –∏–≥—Ä–æ–∫, –±—Ä–æ—Å–∏–≤—à–∏–π –î–∂–æ–∫–µ—Ä–∞ **–ø–æ—Å–ª–µ–¥–Ω–∏–º**.

**–û—Å–æ–±—ã–π —Å–ª—É—á–∞–π:** –ï—Å–ª–∏ –ø—Ä–∏ —Ä–∞–∑–¥–∞—á–µ –∫–æ–∑—ã—Ä–µ–º –≤—ã–ø–∞–ª **–î–∂–æ–∫–µ—Ä** ‚Üí –∏–≥—Ä–∞ –∏–¥–µ—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º **"–±–µ–∑ –∫–æ–∑—ã—Ä–µ–π"**.

### –ó–∞–∫–∞–∑—ã (Betting Phase)

#### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–∫–∞–∑–æ–≤
1. –ü–µ—Ä–≤—ã–º –∑–∞–∫–∞–∑—ã–≤–∞–µ—Ç –∏–≥—Ä–æ–∫ **–ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ** –æ—Ç —Ä–∞–∑–¥–∞—é—â–µ–≥–æ
2. –ü–æ—Å–ª–µ–¥–Ω–∏–º –∑–∞–∫–∞–∑—ã–≤–∞–µ—Ç **—Ä–∞–∑–¥–∞—é—â–∏–π**

#### –ü—Ä–∞–≤–∏–ª–æ "–≤—ã–Ω—É–∂–¥–µ–Ω–Ω–æ–≥–æ" (Forced Bet)
**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:** –°—É–º–º–∞ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ **–ù–ï –î–û–õ–ñ–ù–ê** —Ä–∞–≤–Ω—è—Ç—å—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–∞—Ä—Ç –≤ —Ä–∞—É–Ω–¥–µ.

**–ü—Ä–∏–º–µ—Ä:** –†–∞—É–Ω–¥ –Ω–∞ 5 –∫–∞—Ä—Ç ‚Üí –º–∞–∫—Å–∏–º—É–º 5 –≤–∑—è—Ç–æ–∫.
- –ò–≥—Ä–æ–∫ 1: –∑–∞–∫–∞–∑–∞–ª 2
- –ò–≥—Ä–æ–∫ 2: –∑–∞–∫–∞–∑–∞–ª 1
- –ò–≥—Ä–æ–∫ 3: –∑–∞–∫–∞–∑–∞–ª 1
- –ò–≥—Ä–æ–∫ 4 (—Ä–∞–∑–¥–∞—é—â–∏–π): **–ù–ï –º–æ–∂–µ—Ç –∑–∞–∫–∞–∑–∞—Ç—å 1** (—Ç.–∫. 2+1+1+1 = 5)
  - –ú–æ–∂–µ—Ç –∑–∞–∫–∞–∑–∞—Ç—å: 0, 2, 3, 4, 5
  - **–ù–ï –º–æ–∂–µ—Ç –∑–∞–∫–∞–∑–∞—Ç—å:** 1

**–¢–µ—Ä–º–∏–Ω—ã:**
- **"–û—Ç–Ω–∏–º–∞–µ—Ç—Å—è"** ‚Äî –æ–¥–Ω–∞ –∏–ª–∏ –±–æ–ª–µ–µ –≤–∑—è—Ç–æ–∫ –±—É–¥–µ—Ç –Ω–µ–¥–æ–±—Ä–∞–Ω–∞ (–∫—Ç–æ-—Ç–æ –≤–æ–∑—å–º–µ—Ç –º–µ–Ω—å—à–µ –∑–∞–∫–∞–∑–∞–Ω–Ω–æ–≥–æ)
- **"–ü–∏—Ö–∞–µ—Ç—Å—è"** ‚Äî –ª–∏—à–Ω–∏–µ –≤–∑—è—Ç–∫–∏, –∫—Ç–æ-—Ç–æ –≤–æ–∑—å–º–µ—Ç –±–æ–ª—å—à–µ –∑–∞–∫–∞–∑–∞–Ω–Ω–æ–≥–æ

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
```typescript
function validateBet(
  currentBets: number[],
  newBet: number,
  roundLength: number,
  isLastPlayer: boolean
): boolean {
  const sumBets = currentBets.reduce((a, b) => a + b, 0);
  
  if (isLastPlayer) {
    // –ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–≥—Ä–æ–∫ –ù–ï –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑, –∫–æ—Ç–æ—Ä—ã–π —É—Ä–∞–≤–Ω—è–µ—Ç —Å—É–º–º—É
    return (sumBets + newBet) !== roundLength;
  }
  
  return newBet >= 0 && newBet <= roundLength;
}
```

### –ü–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤

#### –ë–∞–∑–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –æ—á–∫–æ–≤

| –£—Å–ª–æ–≤–∏–µ | –û—á–∫–∏ |
|---------|------|
| **–í–∑—è–ª —Å–≤–æ—ë** (bet === tricks) | `50 √ó bet` –æ—á–∫–æ–≤ |
| **–í–∑—è–ª –í–°–Å** (bet === tricks === roundLength) | `100 √ó roundLength` –æ—á–∫–æ–≤ |
| **–ù–µ –≤–∑—è–ª —Å–≤–æ—ë** (bet ‚â† tricks) | `10 √ó tricks` –æ—á–∫–æ–≤ |
| **"–®—Ç–∞–Ω–≥–∞"** (bet ‚â• 1, –Ω–æ tricks = 0) | **-200 –æ—á–∫–æ–≤** (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à—Ç—Ä–∞—Ñ) |

**–ü—Ä–∏–º–µ—Ä—ã:**
- –ó–∞–∫–∞–∑–∞–ª 3, –≤–∑—è–ª 3 (—Ä–∞—É–Ω–¥ –Ω–∞ 5 –∫–∞—Ä—Ç): **150 –æ—á–∫–æ–≤** (50 √ó 3)
- –ó–∞–∫–∞–∑–∞–ª 5, –≤–∑—è–ª 5 (—Ä–∞—É–Ω–¥ –Ω–∞ 5 –∫–∞—Ä—Ç): **500 –æ—á–∫–æ–≤** (100 √ó 5)
- –ó–∞–∫–∞–∑–∞–ª 2, –≤–∑—è–ª 4: **40 –æ—á–∫–æ–≤** (10 √ó 4) ‚Äî –ø–µ—Ä–µ–±–æ—Ä
- –ó–∞–∫–∞–∑–∞–ª 3, –≤–∑—è–ª 1: **10 –æ—á–∫–æ–≤** (10 √ó 1) ‚Äî –Ω–µ–¥–æ–±–æ—Ä
- –ó–∞–∫–∞–∑–∞–ª 2, –≤–∑—è–ª 0: **-200 –æ—á–∫–æ–≤** ‚Äî –®–¢–ê–ù–ì–ê!

#### –ü—Ä–µ–º–∏–∏ (Bonus) –≤ –∫–æ–Ω—Ü–µ "–ü—É–ª—å–∫–∏"

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π "–ø—É–ª—å–∫–∏" (–±–ª–æ–∫–∞ —Ä–∞–∑–¥–∞—á) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥—Å—á–µ—Ç –ø—Ä–µ–º–∏–π.

**–£—Å–ª–æ–≤–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–º–∏–∏:**
–ò–≥—Ä–æ–∫ **–ù–ò –†–ê–ó–£** –Ω–µ "–∏—Å–ø–æ—Ä—Ç–∏–ª—Å—è" –≤ —Ç–µ—á–µ–Ω–∏–µ –≤—Å–µ–π –ø—É–ª—å–∫–∏ (—Ç.–µ. –≤—Å–µ–≥–¥–∞ –±—Ä–∞–ª —Å–≤–æ—ë: bet === tricks).

**–ú–µ—Ö–∞–Ω–∏–∫–∞ –ø—Ä–µ–º–∏–∏:**
1. –ò–≥—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π **–±—Ä–∞–ª —Å–≤–æ—ë** –≤—Å–µ —Ä–∞—É–Ω–¥—ã –ø—É–ª—å–∫–∏ ‚Üí –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞ –ø—Ä–µ–º–∏—é
2. –ö –µ–≥–æ –æ—á–∫–∞–º **–ø—Ä–∏–±–∞–≤–ª—è–µ—Ç—Å—è** —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è –≤–∑—è—Ç–∫–∞ –≤ –ø—É–ª—å–∫–µ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π)
3. –£ **—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ** **—Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è** —ç—Ç–∞ –∂–µ —Å—É–º–º–∞

**–ü—Ä–∏–º–µ—Ä:**
```
–ü—É–ª—å–∫–∞ 1 (—Ä–∞—É–Ω–¥—ã 1-8):
–ò–≥—Ä–æ–∫ 1: –≤—Å–µ–≥–¥–∞ –±—Ä–∞–ª —Å–≤–æ—ë ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–º–∏—é
–í—ã—Å—à–∞—è –≤–∑—è—Ç–∫–∞ –≤ –ø—É–ª—å–∫–µ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π): 300 –æ—á–∫–æ–≤

–ò–≥—Ä–æ–∫ 1: +300 –æ—á–∫–æ–≤
–ò–≥—Ä–æ–∫ 2 (—Å–ª–µ–¥—É—é—â–∏–π –ø–æ —á–∞—Å–æ–≤–æ–π): -300 –æ—á–∫–æ–≤
```

**–°–ø–æ—Ä–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏:**

–ï—Å–ª–∏ **–Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ —Ä—è–¥–æ–º** (–ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ) –≤—ã—à–ª–∏ –Ω–∞ –ø—Ä–µ–º–∏—é:

**–ü—Ä–∞–≤–∏–ª–æ:**
- –ò–≥—Ä–æ–∫ **–ø–æ–ª—É—á–∞–µ—Ç** –ø—Ä–µ–º–∏—é, –Ω–æ **–ù–ï —Å–ø–∏—Å—ã–≤–∞–µ—Ç** —Å–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ, –µ—Å–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∂–µ –Ω–∞ –ø—Ä–µ–º–∏–∏
- –ò–≥—Ä–æ–∫ **–ù–ï –ø–æ–ª—É—á–∞–µ—Ç** –ø—Ä–µ–º–∏—é –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ, –µ—Å–ª–∏ —Ç–æ—Ç –ø—ã—Ç–∞–ª—Å—è —Å–ø–∏—Å–∞—Ç—å, –Ω–æ —Ç–µ–∫—É—â–∏–π –Ω–∞ –ø—Ä–µ–º–∏–∏
- –ò–≥—Ä–æ–∫ **—Å–ø–∏—Å—ã–≤–∞–µ—Ç** —É —Å–ª–µ–¥—É—é—â–µ–≥–æ, –µ—Å–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π **–ù–ï –Ω–∞ –ø—Ä–µ–º–∏–∏**

**–ü—Ä–∏–º–µ—Ä:** 3 –∏–≥—Ä–æ–∫–∞ –ø–æ–¥—Ä—è–¥ –Ω–∞ –ø—Ä–µ–º–∏–∏ (–ò–≥—Ä–æ–∫ 1, 2, 3):
```
–ò–≥—Ä–æ–∫ 1: +300 (–ø–æ–ª—É—á–∞–µ—Ç), –Ω–æ –ù–ï —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Å –ò–≥—Ä–æ–∫–∞ 2 (—Ç–æ—Ç –Ω–∞ –ø—Ä–µ–º–∏–∏)
–ò–≥—Ä–æ–∫ 2: –ù–ï –ø–æ–ª—É—á–∞–µ—Ç (–ò–≥—Ä–æ–∫ 1 –ø—ã—Ç–∞–ª—Å—è —Å–ø–∏—Å–∞—Ç—å, –Ω–æ 2-–π –Ω–∞ –ø—Ä–µ–º–∏–∏),
         –ù–ï —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Å –ò–≥—Ä–æ–∫–∞ 3 (—Ç–æ—Ç –Ω–∞ –ø—Ä–µ–º–∏–∏)
–ò–≥—Ä–æ–∫ 3: –ù–ï –ø–æ–ª—É—á–∞–µ—Ç (–ò–≥—Ä–æ–∫ 2 –ø—ã—Ç–∞–ª—Å—è —Å–ø–∏—Å–∞—Ç—å, –Ω–æ 3-–π –Ω–∞ –ø—Ä–µ–º–∏–∏),
         –°–ü–ò–°–´–í–ê–ï–¢ —Å –ò–≥—Ä–æ–∫–∞ 4 (—Ç–æ—Ç –ù–ï –Ω–∞ –ø—Ä–µ–º–∏–∏): –ò–≥—Ä–æ–∫ 4: -300
```

**–í–∞–∂–Ω–æ:** –ò–≥—Ä–æ–∫–∏ 1 –∏ 4 —Å—á–∏—Ç–∞—é—Ç—Å—è **"—Ä—è–¥–æ–º"** (–ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ –∑–∞–º—ã–∫–∞–µ—Ç—Å—è –∫—Ä—É–≥).

#### "–ò—Å–ø–æ—Ä—Ç–∏–ª—Å—è" (Spoiled)

–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑ **–Ω–µ –≤–∑—è–ª —Å–≤–æ—ë** (bet ‚â† tricks):
- –ü–æ–º–µ—á–∞–µ—Ç—Å—è —Å–∏–º–≤–æ–ª–æ–º **X** –≤ "–ª–∏—Å—Ç–µ —Å—á–µ—Ç–∞"
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–æ –Ω–∞ –ø—Ä–µ–º–∏—é** –≤ —ç—Ç–æ–π –ø—É–ª—å–∫–µ
- –î–∞–∂–µ –µ—Å–ª–∏ –ø–æ—Ç–æ–º —Å–Ω–æ–≤–∞ –±—É–¥–µ—Ç –±—Ä–∞—Ç—å —Å–≤–æ—ë ‚Äî –ø—Ä–µ–º–∏–∏ —É–∂–µ –Ω–µ –±—É–¥–µ—Ç

#### –û—Ç–º–µ—Ç–∫–∏ –≤ "–ª–∏—Å—Ç–µ —Å—á–µ—Ç–∞"

- **X** ‚Äî –∏–≥—Ä–æ–∫ "–∏—Å–ø–æ—Ä—Ç–∏–ª—Å—è" (–Ω–µ –≤–∑—è–ª —Å–≤–æ—ë —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑)
- **‚óè** (–∂–∏—Ä–Ω–∞—è —Ç–æ—á–∫–∞) ‚Äî —É –∏–≥—Ä–æ–∫–∞ –±—ã–ª –î–∂–æ–∫–µ—Ä –≤ —ç—Ç–æ–π —Ä–∞–∑–¥–∞—á–µ
- **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª** ‚Äî –≤–∑—è—Ç–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø—Ä–∏–ø–ª—é—Å–æ–≤–∞–Ω–∞ –ø—Ä–∏ –ø—Ä–µ–º–∏–∏

### –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã ("–¢—É–∑–æ–≤–∞–Ω–∏–µ")

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–¥–∞—é—â–µ–≥–æ:**
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ø–æ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ –∫–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É –ø–æ –∫—Ä—É–≥—É
2. –ò–≥—Ä–æ–∫, –ø–æ–ª—É—á–∏–≤—à–∏–π **–ø–µ—Ä–≤–æ–≥–æ –¢—É–∑–∞** ‚Üí —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–µ—Ä–≤—ã–º —Ä–∞–∑–¥–∞—é—â–∏–º
3. –≠—Ç–æ—Ç –∏–≥—Ä–æ–∫ –ø–æ–º–µ—â–∞–µ—Ç—Å—è **4-–º –≤ "–õ–∏—Å—Ç–µ —Å—á–µ—Ç–∞"** (–ø–æ—Å–ª–µ–¥–Ω–∏–º)
4. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ: 1-–π, 2-–π, 3-–π

**–û—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å —Ä–∞–∑–¥–∞—é—â–∏—Ö:**
- –†–∞–∑–¥–∞—é—â–∏–µ –º–µ–Ω—è—é—Ç—Å—è **–ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ** –∫–∞–∂–¥—É—é —Ä–∞–∑–¥–∞—á—É
- –û—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å **–ù–ï –º–µ–Ω—è–µ—Ç—Å—è** –¥–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã

### –ü–æ—Ä—è–¥–æ–∫ —Ö–æ–¥–∞

1. **–ü–µ—Ä–≤—ã–π —Ö–æ–¥ –≤ —Ä–∞—É–Ω–¥–µ** –¥–µ–ª–∞–µ—Ç –∏–≥—Ä–æ–∫ **–ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ –æ—Ç —Ä–∞–∑–¥–∞—é—â–µ–≥–æ**
2. **–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥** –¥–µ–ª–∞–µ—Ç –∏–≥—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π **–≤–∑—è–ª –≤–∑—è—Ç–∫—É**
3. –ö–æ–≥–¥–∞ –≤—Å–µ 4 –∏–≥—Ä–æ–∫–∞ –ø–æ—Ö–æ–¥–∏–ª–∏ ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –≤–∑—è—Ç–∫–∏
4. –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –≤–∑—è—Ç–∫–∏ —Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. Game Core (–î–≤–∏–∂–æ–∫ –∏–≥—Ä—ã)

#### 1.1 –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (TypeScript Interfaces)

```typescript
// Enums
enum Suit {
  Hearts = 'hearts',
  Diamonds = 'diamonds',
  Clubs = 'clubs',
  Spades = 'spades'
}

enum Rank {
  Six = 6,
  Seven = 7,
  Eight = 8,
  Nine = 9,
  Ten = 10,
  Jack = 11,
  Queen = 12,
  King = 13,
  Ace = 14
}

enum GamePhase {
  Waiting = 'waiting',      // –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
  Betting = 'betting',      // –§–∞–∑–∞ –∑–∞–∫–∞–∑–æ–≤
  Playing = 'playing',      // –§–∞–∑–∞ –∏–≥—Ä—ã (—Ö–æ–¥—ã)
  Scoring = 'scoring',      // –ü–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤
  Finished = 'finished'     // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
}

enum JokerOption {
  High = 'high',           // –í—ã—Å—à–∞—è –∫–∞—Ä—Ç–∞ –º–∞—Å—Ç–∏
  Low = 'low',             // –ú–ª–∞–¥—à–∞—è –∫–∞—Ä—Ç–∞ –º–∞—Å—Ç–∏
  Top = 'top',             // –°–≤–µ—Ä—Ö—É (–±—å–µ—Ç)
  Bottom = 'bottom'        // –°–Ω–∏–∑—É (–Ω–µ –±—å–µ—Ç)
}

// Card Model
type Card = 
  | { type: 'standard'; suit: Suit; rank: Rank; id: string }
  | { type: 'joker'; id: string; jokerId: 1 | 2 };

// Player Model
interface Player {
  id: string;                    // User ID (Telegram ID –∏–ª–∏ bot-{N})
  name: string;
  isBot: boolean;
  socketId?: string;             // Socket.io client ID
  connected: boolean;
  
  // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  hand: Card[];                  // –ö–∞—Ä—Ç—ã –Ω–∞ —Ä—É–∫–µ
  bet: number | null;            // –ó–∞–∫–∞–∑ (null = –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω)
  tricks: number;                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∑—è—Ç—ã—Ö –≤–∑—è—Ç–æ–∫
  
  // –û—á–∫–∏
  roundScores: number[];         // –û—á–∫–∏ –∑–∞ –∫–∞–∂–¥—ã–π —Ä–∞—É–Ω–¥
  pulkaScores: number[];         // –û—á–∫–∏ –∑–∞ –∫–∞–∂–¥—É—é –ø—É–ª—å–∫—É
  totalScore: number;            // –û–±—â–∞—è —Å—É–º–º–∞ –æ—á–∫–æ–≤
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  spoiled: boolean;              // –ò—Å–ø–æ—Ä—Ç–∏–ª—Å—è –≤ —Ç–µ–∫—É—â–µ–π –ø—É–ª—å–∫–µ
  hadJokerInRounds: boolean[];   // –ë—ã–ª –ª–∏ –¥–∂–æ–∫–µ—Ä –≤ –∫–∞–∂–¥–æ–º —Ä–∞—É–Ω–¥–µ
}

// Game State
interface GameState {
  id: string;                    // UUID –∏–≥—Ä—ã
  
  // –ò–≥—Ä–æ–∫–∏
  players: Player[];             // –í—Å–µ–≥–¥–∞ 4 –∏–≥—Ä–æ–∫–∞
  dealerIndex: number;           // –ò–Ω–¥–µ–∫—Å —Ä–∞–∑–¥–∞—é—â–µ–≥–æ (0-3)
  currentPlayerIndex: number;    // –ß–µ–π —Å–µ–π—á–∞—Å —Ö–æ–¥
  
  // –†–∞—É–Ω–¥
  round: number;                 // 1..24
  pulka: number;                 // 1..4
  phase: GamePhase;
  
  // –ö–∞—Ä—Ç—ã
  trump: Suit | null;            // –ö–æ–∑—ã—Ä–Ω–∞—è –º–∞—Å—Ç—å (null = –±–µ–∑ –∫–æ–∑—ã—Ä–µ–π)
  table: TableCard[];            // –ö–∞—Ä—Ç—ã –Ω–∞ —Å—Ç–æ–ª–µ (0-4)
  
  // –¢–∞–π–º–∏–Ω–≥
  turnStartedAt: number;         // Timestamp –Ω–∞—á–∞–ª–∞ —Ö–æ–¥–∞
  turnTimeoutMs: number;         // 30000 (30 —Å–µ–∫)
  
  // –ò—Å—Ç–æ—Ä–∏—è
  history: RoundHistory[];       // –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ä–∞—É–Ω–¥–æ–≤
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  createdAt: number;
  finishedAt: number | null;
  winnerId: string | null;
}

interface TableCard {
  card: Card;
  playerId: string;
  jokerOption?: JokerOption;     // –ï—Å–ª–∏ —ç—Ç–æ –î–∂–æ–∫–µ—Ä
  requiredSuit?: Suit;           // –ï—Å–ª–∏ –î–∂–æ–∫–µ—Ä High/Low
}

interface RoundHistory {
  round: number;
  trump: Suit | null;
  bets: { [playerId: string]: number };
  tricks: { [playerId: string]: number };
  scores: { [playerId: string]: number };
  tableHistory: TableCard[][];   // –í—Å–µ –≤–∑—è—Ç–∫–∏ —Ä–∞—É–Ω–¥–∞
}
```

#### 1.2 State Machine (–ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π)

**–ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏:**

```
Waiting ‚Üí Betting ‚Üí Playing ‚Üí Scoring ‚Üí 
  ‚Üë                                    ‚Üì
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (–µ—Å–ª–∏ round < 24) ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (–µ—Å–ª–∏ round = 24) ‚Üí Finished
```

**–õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**

```typescript
class StateMachine {
  transition(state: GameState, event: GameEvent): GameState {
    switch (state.phase) {
      case GamePhase.Waiting:
        if (event.type === 'ALL_PLAYERS_READY') {
          return this.startBetting(state);
        }
        break;
        
      case GamePhase.Betting:
        if (event.type === 'ALL_BETS_PLACED') {
          return this.startPlaying(state);
        }
        break;
        
      case GamePhase.Playing:
        if (event.type === 'ROUND_COMPLETE') {
          return this.startScoring(state);
        }
        break;
        
      case GamePhase.Scoring:
        if (state.round < 24) {
          return this.nextRound(state);
        } else {
          return this.finishGame(state);
        }
        break;
    }
    return state;
  }
}
```

#### 1.3 –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª

##### Move Validator (–í–∞–ª–∏–¥–∞—Ü–∏—è —Ö–æ–¥–æ–≤)

```typescript
class MoveValidator {
  /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –∏–≥—Ä–æ–∫ –ø–æ—Ö–æ–¥–∏—Ç—å –¥–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ–π
   */
  validate(
    player: Player,
    card: Card,
    table: TableCard[],
    trump: Suit | null
  ): ValidationResult {
    // 1. –î–∂–æ–∫–µ—Ä –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –≤—Å–µ–≥–¥–∞
    if (card.type === 'joker') {
      return { valid: true };
    }
    
    // 2. –ï—Å–ª–∏ —Å—Ç–æ–ª –ø—É—Å—Ç–æ–π ‚Üí –º–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å –ª—é–±–æ–π –∫–∞—Ä—Ç–æ–π
    if (table.length === 0) {
      return { valid: true };
    }
    
    // 3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç—Ä–µ–±—É–µ–º—É—é –º–∞—Å—Ç—å (–ø–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∞ –Ω–∞ —Å—Ç–æ–ª–µ)
    const leadSuit = this.getLeadSuit(table[0]);
    
    // 4. –ï—Å—Ç—å –ª–∏ —É –∏–≥—Ä–æ–∫–∞ –∫–∞—Ä—Ç—ã —Ç—Ä–µ–±—É–µ–º–æ–π –º–∞—Å—Ç–∏?
    const hasSuit = this.hasCardOfSuit(player.hand, leadSuit);
    
    if (hasSuit) {
      // –û–ë–Ø–ó–ê–ù –∏–≥—Ä–∞—Ç—å –≤ –º–∞—Å—Ç—å
      if (card.suit !== leadSuit) {
        return { 
          valid: false, 
          reason: 'MUST_FOLLOW_SUIT',
          requiredSuit: leadSuit 
        };
      }
      return { valid: true };
    }
    
    // 5. –ù–µ—Ç –º–∞—Å—Ç–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–∑—ã—Ä—å
    const hasTrump = trump && this.hasCardOfSuit(player.hand, trump);
    
    if (hasTrump) {
      // –û–ë–Ø–ó–ê–ù –∏–≥—Ä–∞—Ç—å –∫–æ–∑—ã—Ä—å
      if (card.suit !== trump) {
        return { 
          valid: false, 
          reason: 'MUST_PLAY_TRUMP',
          requiredSuit: trump 
        };
      }
      return { valid: true };
    }
    
    // 6. –ù–µ—Ç –º–∞—Å—Ç–∏ –∏ –∫–æ–∑—ã—Ä—è ‚Üí –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –ª—é–±—É—é –∫–∞—Ä—Ç—É
    return { valid: true };
  }
  
  /**
   * –í–∞–ª–∏–¥–∞—Ü–∏—è —Ö–æ–¥–∞ –î–∂–æ–∫–µ—Ä–æ–º —Å –æ–ø—Ü–∏–µ–π "High" (–≤—ã—Å—à–∞—è –∫–∞—Ä—Ç–∞)
   */
  validateJokerHigh(
    player: Player,
    requiredSuit: Suit
  ): Card {
    const cardsOfSuit = player.hand.filter(
      c => c.type === 'standard' && c.suit === requiredSuit
    );
    
    if (cardsOfSuit.length === 0) {
      throw new Error('NO_CARDS_OF_SUIT');
    }
    
    // –ù–∞–π—Ç–∏ —Å–∞–º—É—é –≤—ã—Å—à—É—é –∫–∞—Ä—Ç—É –º–∞—Å—Ç–∏
    const highestCard = cardsOfSuit.reduce((highest, card) => {
      return card.rank > highest.rank ? card : highest;
    });
    
    return highestCard;
  }
}
```

##### Bet Validator (–í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤)

```typescript
class BetValidator {
  /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–∫–∞–∑–∞
   * 
   * –ü—Ä–∞–≤–∏–ª–æ "–≤—ã–Ω—É–∂–¥–µ–Ω–Ω–æ–≥–æ": —Å—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ –ù–ï –¥–æ–ª–∂–Ω–∞ —Ä–∞–≤–Ω—è—Ç—å—Å—è –¥–ª–∏–Ω–µ —Ä–∞—É–Ω–¥–∞
   */
  validate(
    currentBets: (number | null)[],
    newBet: number,
    roundLength: number,
    playerIndex: number,
    dealerIndex: number
  ): ValidationResult {
    // 1. –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
    if (newBet < 0 || newBet > roundLength) {
      return { valid: false, reason: 'BET_OUT_OF_RANGE' };
    }
    
    // 2. –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É —É–∂–µ —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
    const sumBets = currentBets
      .filter(bet => bet !== null)
      .reduce((sum, bet) => sum + bet, 0);
    
    // 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ "–≤—ã–Ω—É–∂–¥–µ–Ω–Ω–æ–≥–æ"
    const isLastPlayer = (playerIndex === dealerIndex);
    
    if (isLastPlayer) {
      // –ü–æ—Å–ª–µ–¥–Ω–∏–π –∏–≥—Ä–æ–∫ –ù–ï –º–æ–∂–µ—Ç —É—Ä–∞–≤–Ω—è—Ç—å —Å—É–º–º—É
      if (sumBets + newBet === roundLength) {
        return { 
          valid: false, 
          reason: 'FORBIDDEN_BET',
          message: '–°—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–≤–Ω—è—Ç—å—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤–∑—è—Ç–æ–∫'
        };
      }
    }
    
    return { valid: true };
  }
}
```

#### 1.4 Scoring Engine (–ü–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤)

```typescript
class ScoringService {
  /**
   * –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –æ—á–∫–∏ –∑–∞ —Ä–∞—É–Ω–¥ –¥–ª—è –∏–≥—Ä–æ–∫–∞
   */
  calculateRoundScore(
    player: Player,
    roundLength: number
  ): number {
    const { bet, tricks } = player;
    
    // 1. –ò–≥—Ä–æ–∫ –≤–∑—è–ª —Å–≤–æ—ë
    if (bet === tricks) {
      // –í–∑—è–ª –í–°–Å (–≤—Å–µ –≤–∑—è—Ç–∫–∏ –≤ —Ä–∞—É–Ω–¥–µ)
      if (bet === roundLength) {
        return 100 * roundLength;
      }
      // –í–∑—è–ª —Å–≤–æ—ë (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ)
      return 50 * bet;
    }
    
    // 2. "–®—Ç–∞–Ω–≥–∞" (–∑–∞–∫–∞–∑–∞–ª 1+, –Ω–æ –≤–∑—è–ª 0)
    if (bet >= 1 && tricks === 0) {
      return -200;  // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à—Ç—Ä–∞—Ñ
    }
    
    // 3. –ù–µ –≤–∑—è–ª —Å–≤–æ—ë (–ø–µ—Ä–µ–±–æ—Ä –∏–ª–∏ –Ω–µ–¥–æ–±–æ—Ä)
    return 10 * tricks;
  }
  
  /**
   * –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –ø—Ä–µ–º–∏–∏ –≤ –∫–æ–Ω—Ü–µ "–ø—É–ª—å–∫–∏"
   */
  calculatePulkaPremiums(
    players: Player[],
    pulkaHistory: RoundHistory[]
  ): PremiumResult[] {
    const results: PremiumResult[] = [];
    
    // 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ "–Ω–µ –∏—Å–ø–æ—Ä—Ç–∏–ª–∏—Å—å"
    const cleanPlayers = players.filter(p => !p.spoiled);
    
    if (cleanPlayers.length === 0) {
      return results;  // –ù–∏–∫—Ç–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–º–∏—é
    }
    
    // 2. –ù–∞–π—Ç–∏ –≤—ã—Å—à—É—é –≤–∑—è—Ç–∫—É –≤ –ø—É–ª—å–∫–µ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π)
    const highestTrick = this.getHighestTrickScore(
      pulkaHistory.slice(0, -1)  // –í—Å–µ —Ä–∞—É–Ω–¥—ã –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
    );
    
    // 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–µ–º–∏–∏
    cleanPlayers.forEach((player, idx) => {
      const playerIndex = players.indexOf(player);
      const nextPlayerIndex = (playerIndex + 1) % players.length;
      const nextPlayer = players[nextPlayerIndex];
      
      // –ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–º–∏—é
      const received = highestTrick;
      
      // –°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —É —Å–ª–µ–¥—É—é—â–µ–≥–æ, –µ—Å–ª–∏ —Ç–æ—Ç –ù–ï –Ω–∞ –ø—Ä–µ–º–∏–∏
      let takenFrom: string | null = null;
      if (nextPlayer.spoiled) {
        takenFrom = nextPlayer.id;
        nextPlayer.totalScore -= highestTrick;
      }
      
      player.totalScore += received;
      
      results.push({
        playerId: player.id,
        received,
        takenFrom
      });
    });
    
    return results;
  }
  
  /**
   * –ù–∞–π—Ç–∏ —Å–∞–º—É—é –≤—ã—Å–æ–∫—É—é –≤–∑—è—Ç–∫—É –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞—É–Ω–¥–æ–≤
   */
  private getHighestTrickScore(history: RoundHistory[]): number {
    let highest = 0;
    
    history.forEach(round => {
      Object.values(round.scores).forEach(score => {
        if (score > highest) {
          highest = score;
        }
      });
    });
    
    return highest;
  }
}
```

#### 1.5 Deck Service (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–¥–æ–π)

```typescript
class DeckService {
  /**
   * –°–æ–∑–¥–∞—Ç—å –∫–æ–ª–æ–¥—É –∏–∑ 36 –∫–∞—Ä—Ç (34 —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ + 2 –¥–∂–æ–∫–µ—Ä–∞)
   */
  createDeck(): Card[] {
    const deck: Card[] = [];
    
    // 1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã
    const suits = [Suit.Hearts, Suit.Diamonds, Suit.Clubs, Suit.Spades];
    const ranks = [
      Rank.Six, Rank.Seven, Rank.Eight, Rank.Nine, Rank.Ten,
      Rank.Jack, Rank.Queen, Rank.King, Rank.Ace
    ];
    
    suits.forEach(suit => {
      ranks.forEach(rank => {
        // –ò—Å–∫–ª—é—á–∞–µ–º —á–µ—Ä–Ω—ã–µ —à–µ—Å—Ç–µ—Ä–∫–∏
        if (rank === Rank.Six && (suit === Suit.Clubs || suit === Suit.Spades)) {
          return;
        }
        
        deck.push({
          type: 'standard',
          suit,
          rank,
          id: `${suit}-${rank}`
        });
      });
    });
    
    // 2. –î–∂–æ–∫–µ—Ä—ã
    deck.push({ type: 'joker', id: 'joker-1', jokerId: 1 });
    deck.push({ type: 'joker', id: 'joker-2', jokerId: 2 });
    
    return deck;
  }
  
  /**
   * –ü–µ—Ä–µ–º–µ—à–∞—Ç—å –∫–æ–ª–æ–¥—É (Fisher-Yates shuffle)
   */
  shuffle(deck: Card[]): Card[] {
    const shuffled = [...deck];
    
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    
    return shuffled;
  }
  
  /**
   * –†–∞–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞–º
   */
  deal(deck: Card[], playerCount: number, cardsPerPlayer: number): Card[][] {
    const hands: Card[][] = Array(playerCount).fill([]).map(() => []);
    
    for (let i = 0; i < cardsPerPlayer; i++) {
      for (let p = 0; p < playerCount; p++) {
        const card = deck.shift();
        if (card) {
          hands[p].push(card);
        }
      }
    }
    
    return hands;
  }
  
  /**
   * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤–∑—è—Ç–∫–∏
   */
  determineTrickWinner(
    table: TableCard[],
    trump: Suit | null
  ): number {
    let winnerIndex = 0;
    let highestCard = table[0];
    
    for (let i = 1; i < table.length; i++) {
      if (this.compareCards(table[i], highestCard, trump) > 0) {
        highestCard = table[i];
        winnerIndex = i;
      }
    }
    
    return winnerIndex;
  }
  
  /**
   * –°—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–µ –∫–∞—Ä—Ç—ã (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 1 –µ—Å–ª–∏ card1 —Å–∏–ª—å–Ω–µ–µ, -1 –µ—Å–ª–∏ —Å–ª–∞–±–µ–µ, 0 –µ—Å–ª–∏ —Ä–∞–≤–Ω—ã)
   */
  private compareCards(
    card1: TableCard,
    card2: TableCard,
    trump: Suit | null
  ): number {
    // 1. –î–∂–æ–∫–µ—Ä—ã
    if (card1.card.type === 'joker' && card2.card.type === 'joker') {
      // –û–±–∞ –¥–∂–æ–∫–µ—Ä–∞ —Å –æ–ø—Ü–∏–µ–π "–°–≤–µ—Ä—Ö—É" ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–±–µ–∂–¥–∞–µ—Ç
      if (card1.jokerOption === 'top' && card2.jokerOption === 'top') {
        // ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–∞ –ª–æ–≥–∏–∫–∞ –ù–ï–ö–û–†–†–ï–ö–¢–ù–ê!
        // –§—É–Ω–∫—Ü–∏—è compareCards() –Ω–µ –∑–Ω–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Ö–æ–¥–æ–≤.
        // –î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ" –Ω—É–∂–Ω–æ:
        // 1. –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –∫–∞—Ä—Ç –≤ table
        // 2. –ò–õ–ò —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –≤ determineTrickWinner —Å —É—á—ë—Ç–æ–º –ø–æ–∑–∏—Ü–∏–π
        // TODO: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –∏–∑ table
        return 1;  // –í–†–ï–ú–ï–ù–ù–û: –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º card1 –ø–æ—Å–ª–µ–¥–Ω–∏–π
      }
      if (card1.jokerOption === 'bottom') return -1;
      if (card2.jokerOption === 'bottom') return 1;
      return 0;
    }
    
    if (card1.card.type === 'joker') {
      return card1.jokerOption === 'top' ? 1 : -1;
    }
    if (card2.card.type === 'joker') {
      return card2.jokerOption === 'top' ? -1 : 1;
    }
    
    // 2. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–∞—Ä—Ç—ã
    const c1 = card1.card as { suit: Suit; rank: Rank };
    const c2 = card2.card as { suit: Suit; rank: Rank };
    
    // –ö–æ–∑—ã—Ä–Ω–∞—è –º–∞—Å—Ç—å –±—å–µ—Ç –≤—Å–µ
    if (trump) {
      if (c1.suit === trump && c2.suit !== trump) return 1;
      if (c2.suit === trump && c1.suit !== trump) return -1;
    }
    
    // –†–∞–∑–Ω—ã–µ –º–∞—Å—Ç–∏ ‚Üí –ø–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∞ —Å–∏–ª—å–Ω–µ–µ (–ø–µ—Ä–≤—ã–π –∑–∞—à–µ–ª)
    if (c1.suit !== c2.suit) return -1;
    
    // –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –º–∞—Å—Ç—å ‚Üí —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ä–∞–Ω–≥–∏
    return c1.rank > c2.rank ? 1 : -1;
  }
}
```

---

### 2. Network Layer (WebSocket)

#### 2.1 WebSocket Gateway

```typescript
@WebSocketGateway({
  cors: {
    origin: process.env.FRONTEND_URL || '*',
    credentials: true
  }
})
export class GameGateway implements OnGatewayConnection, OnGatewayDisconnect {
  @WebSocketServer()
  server: Server;
  
  constructor(
    private roomManager: RoomManager,
    private gameEngine: GameEngineService,
    private botService: BotService
  ) {}
  
  /**
   * –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
   */
  async handleConnection(client: Socket) {
    try {
      // 1. –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram auth
      const userId = await this.validateTelegramAuth(client);
      
      // 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –±—ã–ª –ª–∏ –∏–≥—Ä–æ–∫ –≤ –∞–∫—Ç–∏–≤–Ω–æ–π –∏–≥—Ä–µ
      const activeRoom = await this.roomManager.findActiveRoom(userId);
      
      if (activeRoom) {
        // –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ!
        await this.handleReconnection(client, userId, activeRoom);
      }
      
      // 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ userId ‚Üí socketId
      await this.roomManager.setUserSocket(userId, client.id);
      
      client.emit('connection_success', { userId });
    } catch (error) {
      client.emit('error', { code: 'AUTH_FAILED', message: error.message });
      client.disconnect();
    }
  }
  
  /**
   * –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
   */
  async handleDisconnect(client: Socket) {
    const userId = await this.roomManager.getUserBySocket(client.id);
    
    if (!userId) return;
    
    // –î–∞—Ç—å –∏–≥—Ä–æ–∫—É 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    setTimeout(async () => {
      const stillDisconnected = !(await this.roomManager.isUserConnected(userId));
      
      if (stillDisconnected) {
        await this.handlePlayerAbandon(userId);
      }
    }, 30000);  // 30 —Å–µ–∫
  }
  
  /**
   * –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
   */
  private async handleReconnection(
    client: Socket,
    userId: string,
    room: GameRoom
  ) {
    // 1. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å socket –∫ –∫–æ–º–Ω–∞—Ç–µ
    client.join(room.id);
    
    // 2. –û–±–Ω–æ–≤–∏—Ç—å socketId –∏–≥—Ä–æ–∫–∞
    const player = room.state.players.find(p => p.id === userId);
    if (player) {
      player.socketId = client.id;
      player.connected = true;
    }
    
    // 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    const state = await this.gameEngine.getGameState(room.id);
    client.emit('game_state_restore', this.serializeState(state, userId));
  }
  
  /**
   * –ò–≥—Ä–æ–∫ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ–ª ‚Üí –∑–∞–º–µ–Ω–∏—Ç—å –±–æ—Ç–æ–º
   */
  private async handlePlayerAbandon(userId: string) {
    const room = await this.roomManager.findActiveRoom(userId);
    
    if (!room) return;
    
    const player = room.state.players.find(p => p.id === userId);
    if (player) {
      player.isBot = true;
      player.connected = false;
      player.name = `Bot (${player.name})`;
    }
    
    // –£–≤–µ–¥–æ–º–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    this.server.to(room.id).emit('player_replaced_by_bot', {
      userId,
      playerName: player.name
    });
  }
}
```

#### 2.2 Event Handlers (–°–æ–±—ã—Ç–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞)

```typescript
@SubscribeMessage('find_game')
async handleFindGame(@ConnectedSocket() client: Socket) {
  const userId = await this.getUserId(client);
  
  // –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å
  await this.roomManager.addToQueue(userId, client);
  
  // –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
  const room = await this.roomManager.tryCreateRoom();
  
  if (room) {
    // –ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ ‚Üí —É–≤–µ–¥–æ–º–∏—Ç—å –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
    room.playerIds.forEach(playerId => {
      const socket = this.roomManager.getSocket(playerId);
      socket?.emit('game_started', { roomId: room.id });
      socket?.join(room.id);
    });
    
    // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
    await this.gameEngine.startGame(room.id);
  } else {
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç: —á–µ—Ä–µ–∑ 60 —Å–µ–∫ –¥–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–æ–≤
    setTimeout(async () => {
      await this.roomManager.fillWithBots(userId);
    }, 60000);
  }
}

@SubscribeMessage('join_room')
async handleJoinRoom(
  @ConnectedSocket() client: Socket,
  @MessageBody() payload: JoinRoomDto
) {
  const userId = await this.getUserId(client);
  
  // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
  client.join(payload.roomId);
  
  // –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
  const state = await this.gameEngine.getGameState(payload.roomId);
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  client.emit('room_state', this.serializeState(state, userId));
}

@SubscribeMessage('make_bet')
async handleMakeBet(
  @ConnectedSocket() client: Socket,
  @MessageBody() payload: MakeBetDto
) {
  try {
    const userId = await this.getUserId(client);
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
    const updatedState = await this.gameEngine.makeBet(
      payload.roomId,
      userId,
      payload.amount
    );
    
    // –û—Ç–º–µ–Ω–∏—Ç—å —Ç–∞–π–º–µ—Ä —Ö–æ–¥–∞
    this.roomManager.clearTimer(payload.roomId, userId);
    
    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ–º
    this.broadcastGameState(payload.roomId, updatedState);
    
    // –ï—Å–ª–∏ –≤—Å–µ –∑–∞–∫–∞–∑—ã —Å–¥–µ–ª–∞–Ω—ã ‚Üí –Ω–∞—á–∞—Ç—å —Ñ–∞–∑—É –∏–≥—Ä—ã
    if (this.allBetsPlaced(updatedState)) {
      await this.gameEngine.startPlayingPhase(payload.roomId);
    } else {
      // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
      this.startTurnTimer(payload.roomId, updatedState.currentPlayerIndex);
    }
    
  } catch (error) {
    client.emit('error', {
      code: error.code || 'UNKNOWN_ERROR',
      message: error.message
    });
  }
}

@SubscribeMessage('throw_card')
async handleThrowCard(
  @ConnectedSocket() client: Socket,
  @MessageBody() payload: ThrowCardDto
) {
  try {
    const userId = await this.getUserId(client);
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ö–æ–¥
    const updatedState = await this.gameEngine.throwCard(
      payload.roomId,
      userId,
      payload.cardId,
      payload.jokerOption  // –ï—Å–ª–∏ —ç—Ç–æ –î–∂–æ–∫–µ—Ä
    );
    
    // –û—Ç–º–µ–Ω–∏—Ç—å —Ç–∞–π–º–µ—Ä
    this.roomManager.clearTimer(payload.roomId, userId);
    
    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    this.broadcastGameState(payload.roomId, updatedState);
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ª–∏ –≤–∑—è—Ç–∫–∞
    if (updatedState.table.length === 4) {
      // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤–∑—è—Ç–∫–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã (–¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏)
      setTimeout(async () => {
        await this.gameEngine.completeTrick(payload.roomId);
        const newState = await this.gameEngine.getGameState(payload.roomId);
        this.broadcastGameState(payload.roomId, newState);
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –ª–∏ —Ä–∞—É–Ω–¥
        if (this.isRoundComplete(newState)) {
          await this.gameEngine.completeRound(payload.roomId);
        } else {
          // –°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥
          this.startTurnTimer(payload.roomId, newState.currentPlayerIndex);
        }
      }, 2000);
    } else {
      // –°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥
      this.startTurnTimer(payload.roomId, updatedState.currentPlayerIndex);
    }
    
  } catch (error) {
    client.emit('error', {
      code: error.code || 'ILLEGAL_MOVE',
      message: error.message
    });
  }
}

@SubscribeMessage('select_trump')
async handleSelectTrump(
  @ConnectedSocket() client: Socket,
  @MessageBody() payload: SelectTrumpDto
) {
  try {
    const userId = await this.getUserId(client);
    
    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä –∫–æ–∑—ã—Ä—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—É–Ω–¥–æ–≤ –ø–æ 9 –∫–∞—Ä—Ç)
    const updatedState = await this.gameEngine.selectTrump(
      payload.roomId,
      userId,
      payload.trump  // Suit | null (null = –±–µ–∑ –∫–æ–∑—ã—Ä–µ–π)
    );
    
    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    this.broadcastGameState(payload.roomId, updatedState);
    
  } catch (error) {
    client.emit('error', {
      code: error.code,
      message: error.message
    });
  }
}
```

#### 2.3 Room Manager

```typescript
@Injectable()
export class RoomManager {
  private waitingQueue: string[] = [];
  private rooms = new Map<string, GameRoom>();
  private userSockets = new Map<string, string>();  // userId ‚Üí socketId
  private timers = new Map<string, NodeJS.Timeout>();
  
  constructor(
    private redis: RedisService,
    private botService: BotService
  ) {}
  
  /**
   * –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –≤ –æ—á–µ—Ä–µ–¥—å
   */
  async addToQueue(userId: string, socket: Socket): Promise<void> {
    if (!this.waitingQueue.includes(userId)) {
      this.waitingQueue.push(userId);
    }
    this.userSockets.set(userId, socket.id);
  }
  
  /**
   * –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏
   */
  async tryCreateRoom(): Promise<GameRoom | null> {
    if (this.waitingQueue.length < 4) {
      return null;
    }
    
    // –í–∑—è—Ç—å –ø–µ—Ä–≤—ã—Ö 4 –∏–≥—Ä–æ–∫–æ–≤
    const playerIds = this.waitingQueue.splice(0, 4);
    
    // –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
    const roomId = uuidv4();
    const room: GameRoom = {
      id: roomId,
      playerIds,
      createdAt: Date.now()
    };
    
    this.rooms.set(roomId, room);
    await this.redis.set(`room:${roomId}`, JSON.stringify(room));
    
    return room;
  }
  
  /**
   * –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã –±–æ—Ç–∞–º–∏
   */
  async fillWithBots(userId: string): Promise<GameRoom> {
    // –£–¥–∞–ª–∏—Ç—å –∏–∑ –æ—á–µ—Ä–µ–¥–∏
    const index = this.waitingQueue.indexOf(userId);
    if (index > -1) {
      this.waitingQueue.splice(index, 1);
    }
    
    // –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É —Å –±–æ—Ç–∞–º–∏
    const playerIds = [
      userId,
      `bot-${uuidv4()}`,
      `bot-${uuidv4()}`,
      `bot-${uuidv4()}`
    ];
    
    const roomId = uuidv4();
    const room: GameRoom = {
      id: roomId,
      playerIds,
      createdAt: Date.now()
    };
    
    this.rooms.set(roomId, room);
    await this.redis.set(`room:${roomId}`, JSON.stringify(room));
    
    return room;
  }
  
  /**
   * –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—É—é –∫–æ–º–Ω–∞—Ç—É –∏–≥—Ä–æ–∫–∞
   */
  async findActiveRoom(userId: string): Promise<GameRoom | null> {
    // –ü–æ–∏—Å–∫ –≤ –ø–∞–º—è—Ç–∏
    for (const room of this.rooms.values()) {
      if (room.playerIds.includes(userId)) {
        return room;
      }
    }
    
    // –ü–æ–∏—Å–∫ –≤ Redis
    const keys = await this.redis.keys('room:*');
    for (const key of keys) {
      const data = await this.redis.get(key);
      const room = JSON.parse(data) as GameRoom;
      if (room.playerIds.includes(userId)) {
        this.rooms.set(room.id, room);  // –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å
        return room;
      }
    }
    
    return null;
  }
}
```

#### 2.4 Turn Timer (–¢–∞–π–º–µ—Ä —Ö–æ–¥–∞)

```typescript
/**
 * –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä –Ω–∞ —Ö–æ–¥
 * –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ —Å—Ö–æ–¥–∏—Ç –∑–∞ 30 —Å–µ–∫ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ö–æ–¥
 */
private startTurnTimer(roomId: string, playerIndex: number) {
  const state = await this.gameEngine.getGameState(roomId);
  const player = state.players[playerIndex];
  
  // –ï—Å–ª–∏ —ç—Ç–æ –±–æ—Ç ‚Üí —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
  if (player.isBot) {
    setTimeout(async () => {
      await this.makeBotMove(roomId, player.id);
    }, 1000);  // 1 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
    return;
  }
  
  // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä –¥–ª—è –∂–∏–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
  const timerKey = `${roomId}-${player.id}`;
  
  const timer = setTimeout(async () => {
    // –í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ö–æ–¥
    await this.makeBotMove(roomId, player.id);
  }, 30000);  // 30 —Å–µ–∫
  
  this.roomManager.setTimer(timerKey, timer);
  
  // –£–≤–µ–¥–æ–º–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ —Ç–∞–π–º–µ—Ä–µ
  this.server.to(roomId).emit('turn_timer_started', {
    playerId: player.id,
    expiresAt: Date.now() + 30000
  });
}

/**
 * –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥ –∑–∞ –∏–≥—Ä–æ–∫–∞ (–±–æ—Ç –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç)
 */
private async makeBotMove(roomId: string, playerId: string) {
  const state = await this.gameEngine.getGameState(roomId);
  
  if (state.phase === GamePhase.Betting) {
    // –°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑
    const bet = this.botService.makeBet(state, playerId);
    await this.handleMakeBet(
      { id: playerId } as Socket,
      { roomId, amount: bet }
    );
  } else if (state.phase === GamePhase.Playing) {
    // –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥
    const move = this.botService.makeMove(state, playerId);
    await this.handleThrowCard(
      { id: playerId } as Socket,
      { roomId, cardId: move.cardId, jokerOption: move.jokerOption }
    );
  }
}
```

---

### 3. Bot AI (–ü—Ä–æ—Å—Ç–æ–π –±–æ—Ç)

#### 3.1 –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (Random Valid Move)

```typescript
@Injectable()
export class BotService {
  constructor(
    private moveValidator: MoveValidator
  ) {}
  
  /**
   * –°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ (–ø—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞)
   */
  makeBet(state: GameState, playerId: string): number {
    const player = state.players.find(p => p.id === playerId);
    const trump = state.trump;
    
    // –ü–æ—Å—á–∏—Ç–∞—Ç—å "—Å–∏–ª—å–Ω—ã–µ" –∫–∞—Ä—Ç—ã
    let strongCards = 0;
    
    player.hand.forEach(card => {
      if (card.type === 'joker') {
        strongCards += 1;  // –î–∂–æ–∫–µ—Ä = –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–∑—è—Ç–∫–∞
      } else if (card.suit === trump && card.rank >= Rank.Jack) {
        strongCards += 0.8;  // –ö–æ–∑—ã—Ä–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã
      } else if (card.rank >= Rank.King) {
        strongCards += 0.5;  // –¢—É–∑—ã –∏ –∫–æ—Ä–æ–ª–∏
      }
    });
    
    // –û–∫—Ä—É–≥–ª–∏—Ç—å
    let bet = Math.floor(strongCards);
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å (–ø—Ä–∞–≤–∏–ª–æ "–≤—ã–Ω—É–∂–¥–µ–Ω–Ω–æ–≥–æ")
    const currentBets = state.players.map(p => p.bet);
    const isValid = this.betValidator.validate(
      currentBets,
      bet,
      player.hand.length,
      state.players.indexOf(player),
      state.dealerIndex
    );
    
    if (!isValid.valid) {
      // –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑
      bet = bet > 0 ? bet - 1 : bet + 1;
    }
    
    return Math.max(0, bet);
  }
  
  /**
   * –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥ (—Å–ª—É—á–∞–π–Ω–∞—è –≤–∞–ª–∏–¥–Ω–∞—è –∫–∞—Ä—Ç–∞)
   */
  makeMove(state: GameState, playerId: string): BotMove {
    const player = state.players.find(p => p.id === playerId);
    
    // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∞–ª–∏–¥–Ω—ã—Ö –∫–∞—Ä—Ç
    const validCards = player.hand.filter(card => {
      const result = this.moveValidator.validate(
        player,
        card,
        state.table,
        state.trump
      );
      return result.valid;
    });
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –∫–∞—Ä—Ç (–æ—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ)
    if (validCards.length === 0) {
      return { cardId: player.hand[0].id };
    }
    
    // –í—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω—É—é
    const randomCard = validCards[Math.floor(Math.random() * validCards.length)];
    
    // –ï—Å–ª–∏ —ç—Ç–æ –î–∂–æ–∫–µ—Ä ‚Üí –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ü–∏—é
    let jokerOption: JokerOption | undefined;
    
    if (randomCard.type === 'joker') {
      if (state.table.length === 0) {
        // –•–æ–¥–∏–º –ø–µ—Ä–≤—ã–º–∏ ‚Üí –≤—ã–±—Ä–∞—Ç—å High/Low
        jokerOption = Math.random() > 0.5 ? JokerOption.High : JokerOption.Low;
      } else {
        // –•–æ–¥–∏–º –Ω–µ –ø–µ—Ä–≤—ã–º–∏ ‚Üí –≤—ã–±—Ä–∞—Ç—å Top/Bottom
        // –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤–∑—è—Ç–∫–∞ ‚Üí Top, –∏–Ω–∞—á–µ Bottom
        const needsTrick = player.tricks < player.bet;
        jokerOption = needsTrick ? JokerOption.Top : JokerOption.Bottom;
      }
    }
    
    return {
      cardId: randomCard.id,
      jokerOption
    };
  }
}
```

---

### 4. Data Persistence (–•—Ä–∞–Ω–∏–ª–∏—â–µ)

#### 4.1 Redis Service (Hot Data)

```typescript
@Injectable()
export class RedisService {
  private client: Redis;
  
  constructor() {
    this.client = new Redis({
      host: process.env.REDIS_HOST || 'localhost',
      port: parseInt(process.env.REDIS_PORT) || 6379,
      password: process.env.REDIS_PASSWORD
    });
  }
  
  /**
   * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (—Å TTL)
   */
  async saveGameState(roomId: string, state: GameState): Promise<void> {
    await this.client.set(
      `game:${roomId}`,
      JSON.stringify(state),
      'EX',
      7200  // TTL 2 —á–∞—Å–∞
    );
  }
  
  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
   */
  async getGameState(roomId: string): Promise<GameState | null> {
    const data = await this.client.get(`game:${roomId}`);
    return data ? JSON.parse(data) : null;
  }
  
  /**
   * –£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É
   */
  async deleteGame(roomId: string): Promise<void> {
    await this.client.del(`game:${roomId}`);
  }
}
```

#### 4.2 PostgreSQL (Cold Data - JSONB)

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∏–≥—Ä
CREATE TABLE games (
  id UUID PRIMARY KEY,
  created_at TIMESTAMP DEFAULT NOW(),
  finished_at TIMESTAMP,
  
  -- –ò–≥—Ä–æ–∫–∏ (–º–∞—Å—Å–∏–≤ JSON)
  players JSONB NOT NULL,
  
  -- –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (JSONB)
  state JSONB NOT NULL,
  
  -- –ü–æ–±–µ–¥–∏—Ç–µ–ª—å
  winner_id TEXT,
  
  -- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
  CONSTRAINT games_players_check CHECK (jsonb_array_length(players) = 4)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_games_players ON games USING GIN (players);
CREATE INDEX idx_games_finished_at ON games (finished_at DESC);
CREATE INDEX idx_games_winner ON games (winner_id);

-- –ü–æ–∏—Å–∫ –∏–≥—Ä –∏–≥—Ä–æ–∫–∞
CREATE INDEX idx_games_player_search ON games ((players::text));
```

```typescript
@Injectable()
export class GameRepository {
  constructor(
    @InjectRepository(GameEntity)
    private repository: Repository<GameEntity>
  ) {}
  
  /**
   * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é –∏–≥—Ä—É
   */
  async saveFinishedGame(state: GameState): Promise<void> {
    await this.repository.save({
      id: state.id,
      players: state.players.map(p => ({ id: p.id, name: p.name })),
      state: state as any,  // JSONB
      winnerId: state.winnerId,
      finishedAt: new Date(state.finishedAt)
    });
  }
  
  /**
   * –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä –∏–≥—Ä–æ–∫–∞
   */
  async getPlayerHistory(userId: string, limit = 20): Promise<GameEntity[]> {
    return this.repository
      .createQueryBuilder('game')
      .where(`game.players::text LIKE :userId`, { userId: `%${userId}%` })
      .orderBy('game.finished_at', 'DESC')
      .limit(limit)
      .getMany();
  }
}
```

---

### 5. REST API (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)

#### 5.1 Games Controller

```typescript
@Controller('api/games')
export class GamesController {
  constructor(
    private gameRepository: GameRepository
  ) {}
  
  /**
   * GET /api/games/history/:userId
   * –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä –∏–≥—Ä–æ–∫–∞
   */
  @Get('history/:userId')
  async getHistory(@Param('userId') userId: string) {
    const games = await this.gameRepository.getPlayerHistory(userId);
    
    return {
      games: games.map(game => ({
        id: game.id,
        finishedAt: game.finishedAt,
        players: game.players,
        myScore: this.getPlayerScore(game.state, userId),
        winnerId: game.winnerId
      }))
    };
  }
  
  /**
   * GET /api/games/:gameId
   * –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∏–≥—Ä—ã
   */
  @Get(':gameId')
  async getGame(@Param('gameId') gameId: string) {
    const game = await this.gameRepository.findOne({ where: { id: gameId } });
    
    if (!game) {
      throw new NotFoundException('Game not found');
    }
    
    return {
      id: game.id,
      state: game.state,
      finishedAt: game.finishedAt
    };
  }
}
```

#### 5.2 Leaderboard Controller

```typescript
@Controller('api/leaderboard')
export class LeaderboardController {
  constructor(
    @InjectDataSource()
    private dataSource: DataSource
  ) {}
  
  /**
   * GET /api/leaderboard
   * –¢–æ–ø-100 –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –æ—á–∫–∞–º
   */
  @Get()
  async getLeaderboard(@Query('limit') limit = 100) {
    const result = await this.dataSource.query(`
      SELECT 
        (players->0->>'id') as user_id,
        (players->0->>'name') as user_name,
        SUM((state->'players'->0->>'totalScore')::int) as total_score,
        COUNT(*) as games_played
      FROM games
      WHERE finished_at IS NOT NULL
      GROUP BY user_id, user_name
      ORDER BY total_score DESC
      LIMIT $1
    `, [limit]);
    
    return { leaderboard: result };
  }
}
```

---

### 6. Telegram Integration

#### 6.1 Auth Guard (–í–∞–ª–∏–¥–∞—Ü–∏—è initData)

```typescript
@Injectable()
export class TelegramAuthGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const client = context.switchToWs().getClient<Socket>();
    const initData = client.handshake.auth.initData;
    
    if (!initData) {
      throw new WsException('AUTH_REQUIRED');
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ HMAC
    const isValid = this.validateInitData(initData);
    
    if (!isValid) {
      throw new WsException('INVALID_AUTH');
    }
    
    return true;
  }
  
  /**
   * –í–∞–ª–∏–¥–∞—Ü–∏—è initData –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram
   */
  private validateInitData(initData: string): boolean {
    const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;
    
    // –ü–∞—Ä—Å–∏–Ω–≥ init_data
    const params = new URLSearchParams(initData);
    const hash = params.get('hash');
    params.delete('hash');
    
    // –°–æ–∑–¥–∞—Ç—å data_check_string
    const dataCheckString = Array.from(params.entries())
      .sort(([a], [b]) => a.localeCompare(b))
      .map(([key, value]) => `${key}=${value}`)
      .join('\n');
    
    // –í—ã—á–∏—Å–ª–∏—Ç—å secret_key
    const secretKey = crypto
      .createHmac('sha256', 'WebAppData')
      .update(BOT_TOKEN)
      .digest();
    
    // –í—ã—á–∏—Å–ª–∏—Ç—å hash
    const calculatedHash = crypto
      .createHmac('sha256', secretKey)
      .update(dataCheckString)
      .digest('hex');
    
    return calculatedHash === hash;
  }
}
```

---

### 7. Testing Strategy

#### 7.1 Unit Tests (Core Logic)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ **–≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª**

```typescript
// game-engine.spec.ts
describe('GameEngine', () => {
  describe('Move Validation', () => {
    it('should require player to follow suit', () => {
      const player = { hand: [hearts6, clubs7] };
      const table = [hearts9];  // –ü–µ—Ä–≤—ã–π –∑–∞—à–µ–ª —á–µ—Ä–≤–∞–º–∏
      
      const result = validator.validate(player, clubs7, table, null);
      
      expect(result.valid).toBe(false);
      expect(result.reason).toBe('MUST_FOLLOW_SUIT');
    });
    
    it('should require trump if no suit', () => {
      const player = { hand: [clubs7, spadesTen] };
      const table = [hearts9];
      const trump = Suit.Spades;
      
      const result = validator.validate(player, clubs7, table, trump);
      
      expect(result.valid).toBe(false);
      expect(result.reason).toBe('MUST_PLAY_TRUMP');
    });
    
    it('should allow joker anytime', () => {
      const player = { hand: [hearts6, joker1] };
      const table = [hearts9];
      
      const result = validator.validate(player, joker1, table, null);
      
      expect(result.valid).toBe(true);
    });
  });
  
  describe('Joker Rules', () => {
    it('should force highest card when Joker demands High', () => {
      const player = { hand: [hearts6, heartsKing, heartsAce] };
      
      const highestCard = validator.validateJokerHigh(player, Suit.Hearts);
      
      expect(highestCard.rank).toBe(Rank.Ace);
    });
    
    it('should handle two Jokers with Top option', () => {
      const table: TableCard[] = [
        { card: joker1, playerId: 'p1', jokerOption: JokerOption.Top },
        { card: hearts9, playerId: 'p2' },
        { card: joker2, playerId: 'p3', jokerOption: JokerOption.Top }
      ];
      
      const winner = deckService.determineTrickWinner(table, null);
      
      expect(winner).toBe(2);  // –ü–æ—Å–ª–µ–¥–Ω–∏–π –î–∂–æ–∫–µ—Ä
    });
  });
  
  describe('Scoring', () => {
    it('should give 50 points per trick when bet matches', () => {
      const player = { bet: 3, tricks: 3 };
      
      const score = scoringService.calculateRoundScore(player, 5);
      
      expect(score).toBe(150);  // 50 * 3
    });
    
    it('should give 100 points per trick when took all', () => {
      const player = { bet: 5, tricks: 5 };
      
      const score = scoringService.calculateRoundScore(player, 5);
      
      expect(score).toBe(500);  // 100 * 5
    });
    
    it('should give -200 for Shtanga', () => {
      const player = { bet: 2, tricks: 0 };
      
      const score = scoringService.calculateRoundScore(player, 5);
      
      expect(score).toBe(-200);
    });
    
    it('should give 10 points per trick when bet != tricks', () => {
      const player = { bet: 2, tricks: 4 };
      
      const score = scoringService.calculateRoundScore(player, 5);
      
      expect(score).toBe(40);  // 10 * 4
    });
  });
  
  describe('Premiums (Pulka Bonus)', () => {
    it('should calculate premium like in "Diod" example from PDF', () => {
      // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞ –∏–∑ PDF
    });
  });
  
  describe('Forced Bet', () => {
    it('should forbid bet that equals round length', () => {
      const currentBets = [2, 1, 1];
      const newBet = 1;
      const roundLength = 5;
      const isLastPlayer = true;
      
      const result = betValidator.validate(
        currentBets,
        newBet,
        roundLength,
        3,
        3
      );
      
      expect(result.valid).toBe(false);
      expect(result.reason).toBe('FORBIDDEN_BET');
    });
  });
});
```

**–¶–µ–ª—å:** –ù–∞–ø–∏—Å–∞—Ç—å **50+ —Ç–µ—Å—Ç–æ–≤** –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª –∏–∑ PDF.

#### 7.2 Integration Tests

```typescript
describe('Game Flow (Integration)', () => {
  it('should complete full round', async () => {
    // 1. –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É
    const game = await gameEngine.createGame(['p1', 'p2', 'p3', 'p4']);
    
    // 2. –†–∞–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—ã
    await gameEngine.dealCards(game.id, 5);
    
    // 3. –°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑—ã
    await gameEngine.makeBet(game.id, 'p1', 2);
    await gameEngine.makeBet(game.id, 'p2', 1);
    await gameEngine.makeBet(game.id, 'p3', 1);
    await gameEngine.makeBet(game.id, 'p4', 0);  // –í—ã–Ω—É–∂–¥–µ–Ω–Ω—ã–π
    
    // 4. –°—ã–≥—Ä–∞—Ç—å –≤–∑—è—Ç–∫–∏
    // ... (–ø–æ–ª–Ω—ã–π —Ñ–ª–æ—É)
    
    // 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤
    const finalState = await gameEngine.getGameState(game.id);
    expect(finalState.phase).toBe(GamePhase.Scoring);
  });
});
```

#### 7.3 Load Testing

```bash
# Artillery config
config:
  target: "ws://localhost:3000"
  phases:
    - duration: 60
      arrivalRate: 10  # 10 –Ω–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π/—Å–µ–∫

scenarios:
  - name: "Bot game simulation"
    engine: "socketio"
    flow:
      - emit:
          channel: "find_game"
      - think: 2
      - emit:
          channel: "make_bet"
          data:
            amount: 2
```

---

### 8. Deployment

#### 8.1 Docker Compose

```yaml
version: '3.8'

services:
  backend:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - REDIS_HOST=redis
      - POSTGRES_HOST=postgres
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
    depends_on:
      - redis
      - postgres
  
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
  
  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_DB: joker
      POSTGRES_USER: joker
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  redis_data:
  postgres_data:
```

#### 8.2 PM2 Ecosystem

```javascript
module.exports = {
  apps: [{
    name: 'joker-backend',
    script: './dist/main.js',
    instances: 2,
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production'
    },
    error_file: './logs/error.log',
    out_file: './logs/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss',
    merge_logs: true,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G'
  }]
};
```

---

## üìù WebSocket API Contract

### –°–æ–±—ã—Ç–∏—è Client ‚Üí Server

#### `find_game`
–ù–∞–π—Ç–∏ –∏–≥—Ä—É (–¥–æ–±–∞–≤–∏—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥—å).

**Payload:** –ù–µ—Ç (–ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç `{}`)

**Response:**
1. `game_started` (–∫–æ–≥–¥–∞ –∫–æ–º–Ω–∞—Ç–∞ —Å–æ–±—Ä–∞–Ω–∞)
2. `waiting_for_players` (–µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ—á–µ—Ä–µ–¥—å, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

#### `join_room`
–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–º–Ω–∞—Ç–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å—Å—ã–ª–∫–µ).

**Payload:**
```json
{
  "roomId": "uuid-string"
}
```

---

#### `make_bet`
–°–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ –≤–∑—è—Ç–æ–∫ –≤ —Ñ–∞–∑–µ `betting`.

**Payload:**
```json
{
  "roomId": "uuid-string",
  "amount": 2
}
```

**–û—à–∏–±–∫–∏:**
- `FORBIDDEN_BET`: –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ "–≤—ã–Ω—É–∂–¥–µ–Ω–Ω–æ–≥–æ" (—Å—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ == –¥–ª–∏–Ω–µ —Ä–∞—É–Ω–¥–∞ —É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–≥—Ä–æ–∫–∞).
- `BET_OUT_OF_RANGE`: –ó–∞–∫–∞–∑ –º–µ–Ω—å—à–µ 0 –∏–ª–∏ –±–æ–ª—å—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ä—Ç.

---

#### `throw_card`
–°–¥–µ–ª–∞—Ç—å —Ö–æ–¥ –∫–∞—Ä—Ç–æ–π.

**Payload:**
```json
{
  "roomId": "uuid-string",
  "cardId": "hearts-10",
  "jokerOption": "high" // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ cardId == "joker-1" –∏–ª–∏ "joker-2"
}
```
*–í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `jokerOption`:* `"high"`, `"low"`, `"top"`, `"bottom"`.

**–û—à–∏–±–∫–∏:**
- `ILLEGAL_MOVE`: –ù–µ –≤ –º–∞—Å—Ç—å, –∏–ª–∏ –Ω–µ –∫–æ–∑—ã—Ä—å (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏), –∏–ª–∏ —Ö–æ–¥ –Ω–µ –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å.

---

#### `select_trump`
–í—ã–±—Ä–∞—Ç—å –∫–æ–∑—ã—Ä—å (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–≥—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∫–æ–∑—ã—Ä—å –≤ —Ä–∞—É–Ω–¥–∞—Ö –ø–æ 9 –∫–∞—Ä—Ç).

**Payload:**
```json
{
  "roomId": "uuid-string",
  "trump": "hearts" // –∏–ª–∏ null –¥–ª—è –∏–≥—Ä—ã "–±–µ–∑ –∫–æ–∑—ã—Ä–µ–π"
}
```

---

### –°–æ–±—ã—Ç–∏—è Server ‚Üí Client

–≠—Ç–∏ —Å–æ–±—ã—Ç–∏—è –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω "—Å–ª—É—à–∞—Ç—å".

#### `game_started`
–ò–≥—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞ –∏ –Ω–∞—á–∞–ª–∞—Å—å. –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —ç–∫—Ä–∞–Ω –Ω–∞ –∏–≥—Ä–æ–≤–æ–π —Å—Ç–æ–ª.

**Data:**
```json
{
  "roomId": "uuid-string",
  "players": [
    { "id": "user1", "name": "Alex", "avatarUrl": "..." },
    { "id": "user2", "name": "Bot", "avatarUrl": "..." },
    ...
  ]
}
```

---

#### `game_state_update`
–û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏. –ü—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ **–ª—é–±–æ–≥–æ** –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Ö–æ–¥, —Å—Ç–∞–≤–∫–∞, –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥).

**–í–∞–∂–Ω–æ:** –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã**. –ò–≥—Ä–æ–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –∫–∞—Ä—Ç—ã —Å–æ–ø–µ—Ä–Ω–∏–∫–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ `hand`.

**Data:**
```json
{
  "phase": "playing", // betting, scoring, etc.
  "round": 5,         // –¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥ (–∫–æ–ª-–≤–æ –∫–∞—Ä—Ç)
  "pulka": 1,
  "trump": "hearts",  // –¢–µ–∫—É—â–∏–π –∫–æ–∑—ã—Ä—å
  
  "currentPlayerIndex": 2, // –ß–µ–π —Å–µ–π—á–∞—Å —Ö–æ–¥
  
  "table": [ // –ö–∞—Ä—Ç—ã –Ω–∞ —Å—Ç–æ–ª–µ
    { "card": { "id": "hearts-10", ... }, "playerId": "user1" }
  ],
  
  "myHand": [ // –¢–û–õ–¨–ö–û –∫–∞—Ä—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    { "id": "clubs-ace", "suit": "clubs", "rank": 14 }
  ],
  
  "players": [ // –ü—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ –æ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–∞—Ö
    {
      "id": "user1",
      "name": "Alex",
      "cardsCount": 4, // –°–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç –æ—Å—Ç–∞–ª–æ—Å—å (–±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –Ω–æ–º–∏–Ω–∞–ª–∞)
      "bet": 2,        // –ó–∞–∫–∞–∑
      "tricks": 1,     // –í–∑—è—Ç—ã–µ –≤–∑—è—Ç–∫–∏
      "connected": true
    },
    ...
  ],
  
  "turnTimeout": 28500 // –°–∫–æ–ª—å–∫–æ –º—Å –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∞ —Ö–æ–¥
}
```

---

#### `turn_timer_started`
–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª —Ç–∞–π–º–µ—Ä –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å "–≥—Ä–∞–¥—É—Å–Ω–∏–∫" –∏–ª–∏ –∫–∞—É–Ω—Ç–µ—Ä.

**Data:**
```json
{
  "playerId": "user2",
  "expiresAt": 1708500000123 // Timestamp –æ–∫–æ–Ω—á–∞–Ω–∏—è
}
```

---

#### `round_result`
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —Ä–∞—É–Ω–¥–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å–ª–µ–¥—É—é—â–µ–≥–æ (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞).

**Data:**
```json
{
  "scores": {
    "user1": 150, // +150 –æ—á–∫–æ–≤
    "user2": -200 // –®—Ç–∞–Ω–≥–∞!
  },
  "totalScores": { "user1": 450, ... }
}
```

---

#### `game_over`
–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.

**Data:**
```json
{
  "winnerId": "user1",
  "finalTable": [ ... ], // –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  "rewards": { "xp": 100, "rating": +25 }
}
```

#### `error`
–û–±—â–∞—è –æ—à–∏–±–∫–∞ (–≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ).

**Data:**
```json
{
  "code": "ILLEGAL_MOVE",
  "message": "–í—ã –æ–±—è–∑–∞–Ω—ã –ø–æ–ª–æ–∂–∏—Ç—å –ø–∏–∫–∏!"
}
```

---

## ‚úÖ Definition of Done (–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏)

–ü—Ä–æ–µ–∫—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º, –µ—Å–ª–∏:

1.  **–ü—Ä–æ—Ö–æ–¥—è—Ç —Ç–µ—Å—Ç—ã:** 50+ unit-—Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ö–æ–¥–æ–≤ –∏ –ø–æ–¥—Å—á–µ—Ç–∞ –æ—á–∫–æ–≤ (–≤–∫–ª—é—á–∞—è "–®—Ç–∞–Ω–≥–∏" –∏ –ø—Ä–µ–º–∏–∏).
2.  **–†–∞–±–æ—Ç–∞–µ—Ç Bot-fallback:** –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–∫–∞–±–µ–ª—å, —á–µ—Ä–µ–∑ 30-60 —Å–µ–∫ –∑–∞ –Ω–µ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ö–æ–¥–∏—Ç—å –±–æ—Ç. –ò–≥—Ä–∞ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –∫–æ–Ω—Ü–∞.
3.  **–ù–µ—Ç Race Conditions:** –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Ö–æ–¥–∞ –æ—Ç –¥–≤—É—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π, –≤—Ç–æ—Ä–æ–π –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É (–∏–ª–∏ –∏–≥–Ω–æ—Ä), —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è.
4.  **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`F5`) –∏–≥—Ä–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π `game_state_update` –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏–≥—Ä–∞—Ç—å.
5.  **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í –ë–î Postgres –∑–∞–ø–∏—Å–∞–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è —Å—ã–≥—Ä–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSONB –¥–ª—è –∞–¥–º–∏–Ω–∫–∏.

--- END OF FILE ---